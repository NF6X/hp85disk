\hypertarget{mmc__hal_8c}{\section{fatfs/mmc\-\_\-hal.c File Reference}
\label{mmc__hal_8c}\index{fatfs/mmc\-\_\-hal.\-c@{fatfs/mmc\-\_\-hal.\-c}}
}


M\-M\-C Hardware Layer for Fat\-Fs.  


{\ttfamily \#include $<$hardware/hardware.\-h$>$}\\*
{\ttfamily \#include \char`\"{}mmc\-\_\-hal.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}ff.\-h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{mmc__hal_8c_a39e43f6e6b8c7bc166e27b7471369df9}{mmc\-\_\-install\-\_\-timer} (void)
\begin{DoxyCompactList}\small\item\em Install M\-M\-C timer task\-: \hyperlink{mmc__hal_8c_a00ac994ca5d977f47d3a80432e644499}{mmc\-\_\-task()} \end{DoxyCompactList}\item 
void \hyperlink{mmc__hal_8c_adb1cbf0a5ae766b038740c9538497724}{mmc\-\_\-set\-\_\-ms\-\_\-timeout} (int16\-\_\-t ms)
\begin{DoxyCompactList}\small\item\em Set M\-M\-C timeout timer in Milliseconds. \end{DoxyCompactList}\item 
void \hyperlink{mmc__hal_8c_ac2daa4c68686d419b1fb7a93df3847a9}{mmc\-\_\-set\-\_\-us\-\_\-timeout} (int32\-\_\-t us)
\begin{DoxyCompactList}\small\item\em See M\-M\-C timeout timer in Microseconds. \end{DoxyCompactList}\item 
int \hyperlink{mmc__hal_8c_a21da90d8f30005eb90574a029a6fc81d}{mmc\-\_\-test\-\_\-timeout} (void)
\begin{DoxyCompactList}\small\item\em Test M\-M\-C timeout status. \end{DoxyCompactList}\item 
void \hyperlink{mmc__hal_8c_a84ab2ed27e7b0751183feb6c89a4f931}{mmc\-\_\-clear\-\_\-timeout} (void)
\begin{DoxyCompactList}\small\item\em Clear/\-Initialize M\-M\-C timeout value. \end{DoxyCompactList}\item 
void \hyperlink{mmc__hal_8c_a00ac994ca5d977f47d3a80432e644499}{mmc\-\_\-task} (void)
\begin{DoxyCompactList}\small\item\em This function is called every M\-M\-C\-\_\-\-T\-I\-M\-E\-R\-\_\-\-T\-I\-C\-\_\-\-U\-S. \end{DoxyCompactList}\item 
uint8\-\_\-t \hyperlink{mmc__hal_8c_a7c4051db12b5a8afc9bb71b62e50af32}{mmc\-\_\-xchg\-\_\-spi} (uint8\-\_\-t a)
\begin{DoxyCompactList}\small\item\em M\-M\-C S\-P\-I send and receive character. \end{DoxyCompactList}\item 
void \hyperlink{mmc__hal_8c_ae9d8b33ee8fd54f03d5d6946d6022df9}{mmc\-\_\-spi\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em M\-M\-C S\-P\-I bus init. \end{DoxyCompactList}\item 
void \hyperlink{mmc__hal_8c_a120c1501f6694e4947cb37f09679dda9}{mmc\-\_\-slow} ()
\begin{DoxyCompactList}\small\item\em M\-M\-C set slow S\-P\-I bus speed. \end{DoxyCompactList}\item 
void \hyperlink{mmc__hal_8c_a7d41efb1efa51ca4c815ee275553ecae}{mmc\-\_\-fast} ()
\begin{DoxyCompactList}\small\item\em M\-M\-C fast S\-P\-I bus speed. \end{DoxyCompactList}\item 
void \hyperlink{mmc__hal_8c_ac211d02032f178f2391e233397bde391}{mmc\-\_\-power\-\_\-on} ()
\begin{DoxyCompactList}\small\item\em M\-M\-C power O\-N initialize. \end{DoxyCompactList}\item 
void \hyperlink{mmc__hal_8c_a4fadc872519a4c0ffa09247a0f65523b}{mmc\-\_\-power\-\_\-off} ()
\begin{DoxyCompactList}\small\item\em M\-M\-C power off. \end{DoxyCompactList}\item 
int \hyperlink{mmc__hal_8c_a7883cbf41fbdaad282d75a3de93d0224}{mmc\-\_\-power\-\_\-status} ()
\begin{DoxyCompactList}\small\item\em M\-M\-C power status. \end{DoxyCompactList}\item 
void \hyperlink{mmc__hal_8c_a75bf39ed652aa5f34bc0a4b6a10b9f21}{mmc\-\_\-cs\-\_\-enable} ()
\begin{DoxyCompactList}\small\item\em M\-M\-C C\-S enable. \end{DoxyCompactList}\item 
void \hyperlink{mmc__hal_8c_a7d29ab480325257aad2004f7fa341baf}{mmc\-\_\-cs\-\_\-disable} ()
\begin{DoxyCompactList}\small\item\em M\-M\-C C\-S disable. \end{DoxyCompactList}\item 
int \hyperlink{mmc__hal_8c_ab7da280dcb0a47bcbb21bc8a79c607f8}{mmc\-\_\-ins\-\_\-status} ()
\begin{DoxyCompactList}\small\item\em M\-M\-C Card Inserted status. \end{DoxyCompactList}\item 
int \hyperlink{mmc__hal_8c_a4ffa13ede463950ddb818c9ef623538f}{mmc\-\_\-wp\-\_\-status} ()
\begin{DoxyCompactList}\small\item\em M\-M\-C Card Write Protect status. \end{DoxyCompactList}\item 
int \hyperlink{mmc__hal_8c_a2495ace2b776ad3746061014ed748bc4}{mmc\-\_\-init} (int cold)
\begin{DoxyCompactList}\small\item\em Initialize M\-M\-C and Fat\-Fs interface, display diagnostics. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
volatile int32\-\_\-t \hyperlink{mmc__hal_8c_ab6838b44b2b3eba0ded1e5196026fd59}{mmc\-\_\-us\-\_\-timeout}
\begin{DoxyCompactList}\small\item\em M\-M\-C timer tic in Microseconds. \end{DoxyCompactList}\item 
static int32\-\_\-t \hyperlink{mmc__hal_8c_a071dea3cf3cdd93a412bc3a58998799d}{\-\_\-\-\_\-mmc\-\_\-task\-\_\-timer}
\begin{DoxyCompactList}\small\item\em M\-M\-C Microsecond accumulator for \hyperlink{mmc__hal_8c_a00ac994ca5d977f47d3a80432e644499}{mmc\-\_\-task()} \end{DoxyCompactList}\item 
\hyperlink{diskio_8h_adba6790898ce4029c20a34b898ce73c1}{D\-S\-T\-A\-T\-U\-S} \hyperlink{mmc__hal_8c_a5e05b0c3f7ba56fa9c23be08c497eb9f}{Stat}
\begin{DoxyCompactList}\small\item\em M\-M\-C Fat\-Fs insert,write protect status. \end{DoxyCompactList}\item 
static int \hyperlink{mmc__hal_8c_a530d484dee6be1fc954f32f677add7c4}{mmc\-\_\-init\-\_\-flag} = 0
\end{DoxyCompactItemize}


\subsection{Detailed Description}
M\-M\-C Hardware Layer for Fat\-Fs. \begin{DoxyParagraph}{Edit History}

\begin{DoxyItemize}
\item \mbox{[}1.\-0\mbox{]} \mbox{[}Mike Gore\mbox{]} Initial revision of file.
\end{DoxyItemize}
\end{DoxyParagraph}
\begin{DoxyParagraph}{Copyright \copyright{} 2014 Mike Gore, Inc. All rights reserved.}

\end{DoxyParagraph}


Definition in file \hyperlink{mmc__hal_8c_source}{mmc\-\_\-hal.\-c}.



\subsection{Function Documentation}
\hypertarget{mmc__hal_8c_a84ab2ed27e7b0751183feb6c89a4f931}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-clear\-\_\-timeout@{mmc\-\_\-clear\-\_\-timeout}}
\index{mmc\-\_\-clear\-\_\-timeout@{mmc\-\_\-clear\-\_\-timeout}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-clear\-\_\-timeout}]{\setlength{\rightskip}{0pt plus 5cm}void mmc\-\_\-clear\-\_\-timeout (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_a84ab2ed27e7b0751183feb6c89a4f931}


Clear/\-Initialize M\-M\-C timeout value. 

\begin{DoxySeeAlso}{See Also}
\hyperlink{mmc__hal_8c_ac2daa4c68686d419b1fb7a93df3847a9}{mmc\-\_\-set\-\_\-us\-\_\-timeout()} 

\hyperlink{mmc__hal_8c_adb1cbf0a5ae766b038740c9538497724}{mmc\-\_\-set\-\_\-ms\-\_\-timeout()} 
\end{DoxySeeAlso}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 98 of file mmc\-\_\-hal.\-c.

\hypertarget{mmc__hal_8c_a7d29ab480325257aad2004f7fa341baf}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-cs\-\_\-disable@{mmc\-\_\-cs\-\_\-disable}}
\index{mmc\-\_\-cs\-\_\-disable@{mmc\-\_\-cs\-\_\-disable}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-cs\-\_\-disable}]{\setlength{\rightskip}{0pt plus 5cm}void mmc\-\_\-cs\-\_\-disable (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_a7d29ab480325257aad2004f7fa341baf}


M\-M\-C C\-S disable. 


\begin{DoxyItemize}
\item M\-M\-C S\-P\-I chip sellect \begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 246 of file mmc\-\_\-hal.\-c.



Referenced by mmc\-\_\-deselect().

\hypertarget{mmc__hal_8c_a75bf39ed652aa5f34bc0a4b6a10b9f21}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-cs\-\_\-enable@{mmc\-\_\-cs\-\_\-enable}}
\index{mmc\-\_\-cs\-\_\-enable@{mmc\-\_\-cs\-\_\-enable}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-cs\-\_\-enable}]{\setlength{\rightskip}{0pt plus 5cm}void mmc\-\_\-cs\-\_\-enable (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_a75bf39ed652aa5f34bc0a4b6a10b9f21}


M\-M\-C C\-S enable. 


\begin{DoxyItemize}
\item M\-M\-C S\-P\-I chip sellect \begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 235 of file mmc\-\_\-hal.\-c.



Referenced by mmc\-\_\-select().

\hypertarget{mmc__hal_8c_a7d41efb1efa51ca4c815ee275553ecae}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-fast@{mmc\-\_\-fast}}
\index{mmc\-\_\-fast@{mmc\-\_\-fast}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-fast}]{\setlength{\rightskip}{0pt plus 5cm}void mmc\-\_\-fast (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_a7d41efb1efa51ca4c815ee275553ecae}


M\-M\-C fast S\-P\-I bus speed. 


\begin{DoxyItemize}
\item Used during normal file I\-O phases \begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 188 of file mmc\-\_\-hal.\-c.



Referenced by mmc\-\_\-disk\-\_\-initialize().

\hypertarget{mmc__hal_8c_a2495ace2b776ad3746061014ed748bc4}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-init@{mmc\-\_\-init}}
\index{mmc\-\_\-init@{mmc\-\_\-init}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}int mmc\-\_\-init (
\begin{DoxyParamCaption}
\item[{int}]{cold}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_a2495ace2b776ad3746061014ed748bc4}


Initialize M\-M\-C and Fat\-Fs interface, display diagnostics. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cold} & 1 also initailize M\-M\-C timer. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\end{DoxyReturn}


Definition at line 281 of file mmc\-\_\-hal.\-c.



Referenced by fatfs\-\_\-tests(), main(), and open().

\hypertarget{mmc__hal_8c_ab7da280dcb0a47bcbb21bc8a79c607f8}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-ins\-\_\-status@{mmc\-\_\-ins\-\_\-status}}
\index{mmc\-\_\-ins\-\_\-status@{mmc\-\_\-ins\-\_\-status}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-ins\-\_\-status}]{\setlength{\rightskip}{0pt plus 5cm}int mmc\-\_\-ins\-\_\-status (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_ab7da280dcb0a47bcbb21bc8a79c607f8}


M\-M\-C Card Inserted status. 


\begin{DoxyItemize}
\item We do not detect card insert status in this project. \begin{DoxyReturn}{Returns}
1 card inserted 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 257 of file mmc\-\_\-hal.\-c.



Referenced by gpib\-\_\-error\-\_\-test(), and mmc\-\_\-task().

\hypertarget{mmc__hal_8c_a39e43f6e6b8c7bc166e27b7471369df9}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-install\-\_\-timer@{mmc\-\_\-install\-\_\-timer}}
\index{mmc\-\_\-install\-\_\-timer@{mmc\-\_\-install\-\_\-timer}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-install\-\_\-timer}]{\setlength{\rightskip}{0pt plus 5cm}void mmc\-\_\-install\-\_\-timer (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_a39e43f6e6b8c7bc166e27b7471369df9}


Install M\-M\-C timer task\-: \hyperlink{mmc__hal_8c_a00ac994ca5d977f47d3a80432e644499}{mmc\-\_\-task()} 

\begin{DoxySeeAlso}{See Also}
\hyperlink{mmc__hal_8c_a00ac994ca5d977f47d3a80432e644499}{mmc\-\_\-task()} 
\end{DoxySeeAlso}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 34 of file mmc\-\_\-hal.\-c.



Referenced by mmc\-\_\-init().

\hypertarget{mmc__hal_8c_a4fadc872519a4c0ffa09247a0f65523b}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-power\-\_\-off@{mmc\-\_\-power\-\_\-off}}
\index{mmc\-\_\-power\-\_\-off@{mmc\-\_\-power\-\_\-off}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-power\-\_\-off}]{\setlength{\rightskip}{0pt plus 5cm}void mmc\-\_\-power\-\_\-off (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_a4fadc872519a4c0ffa09247a0f65523b}


M\-M\-C power off. 


\begin{DoxyItemize}
\item We do not control power to the M\-M\-C device in this project. \begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 213 of file mmc\-\_\-hal.\-c.



Referenced by mmc\-\_\-disk\-\_\-initialize(), and mmc\-\_\-disk\-\_\-ioctl().

\hypertarget{mmc__hal_8c_ac211d02032f178f2391e233397bde391}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-power\-\_\-on@{mmc\-\_\-power\-\_\-on}}
\index{mmc\-\_\-power\-\_\-on@{mmc\-\_\-power\-\_\-on}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-power\-\_\-on}]{\setlength{\rightskip}{0pt plus 5cm}void mmc\-\_\-power\-\_\-on (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_ac211d02032f178f2391e233397bde391}


M\-M\-C power O\-N initialize. 


\begin{DoxyItemize}
\item We do not control power to the M\-M\-C device in this project. \begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 199 of file mmc\-\_\-hal.\-c.



Referenced by mmc\-\_\-disk\-\_\-initialize(), and mmc\-\_\-init().

\hypertarget{mmc__hal_8c_a7883cbf41fbdaad282d75a3de93d0224}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-power\-\_\-status@{mmc\-\_\-power\-\_\-status}}
\index{mmc\-\_\-power\-\_\-status@{mmc\-\_\-power\-\_\-status}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-power\-\_\-status}]{\setlength{\rightskip}{0pt plus 5cm}int mmc\-\_\-power\-\_\-status (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_a7883cbf41fbdaad282d75a3de93d0224}


M\-M\-C power status. 


\begin{DoxyItemize}
\item We do not control power to the M\-M\-C device in this project. \begin{DoxyReturn}{Returns}
1 power is alwasy on 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 223 of file mmc\-\_\-hal.\-c.

\hypertarget{mmc__hal_8c_adb1cbf0a5ae766b038740c9538497724}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-set\-\_\-ms\-\_\-timeout@{mmc\-\_\-set\-\_\-ms\-\_\-timeout}}
\index{mmc\-\_\-set\-\_\-ms\-\_\-timeout@{mmc\-\_\-set\-\_\-ms\-\_\-timeout}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-set\-\_\-ms\-\_\-timeout}]{\setlength{\rightskip}{0pt plus 5cm}void mmc\-\_\-set\-\_\-ms\-\_\-timeout (
\begin{DoxyParamCaption}
\item[{int16\-\_\-t}]{ms}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_adb1cbf0a5ae766b038740c9538497724}


Set M\-M\-C timeout timer in Milliseconds. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em ms} & timeout in Milliseconds\\
\hline
\end{DoxyParams}
\begin{DoxySeeAlso}{See Also}
\hyperlink{mmc__hal_8c_a21da90d8f30005eb90574a029a6fc81d}{mmc\-\_\-test\-\_\-timeout} ( ) 
\end{DoxySeeAlso}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 48 of file mmc\-\_\-hal.\-c.



Referenced by mmc\-\_\-disk\-\_\-initialize(), rcvr\-\_\-datablock(), and wait\-\_\-ready().

\hypertarget{mmc__hal_8c_ac2daa4c68686d419b1fb7a93df3847a9}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-set\-\_\-us\-\_\-timeout@{mmc\-\_\-set\-\_\-us\-\_\-timeout}}
\index{mmc\-\_\-set\-\_\-us\-\_\-timeout@{mmc\-\_\-set\-\_\-us\-\_\-timeout}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-set\-\_\-us\-\_\-timeout}]{\setlength{\rightskip}{0pt plus 5cm}void mmc\-\_\-set\-\_\-us\-\_\-timeout (
\begin{DoxyParamCaption}
\item[{int32\-\_\-t}]{us}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_ac2daa4c68686d419b1fb7a93df3847a9}


See M\-M\-C timeout timer in Microseconds. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em us} & timeout in Microseconds\\
\hline
\end{DoxyParams}
\begin{DoxySeeAlso}{See Also}
\hyperlink{mmc__hal_8c_a21da90d8f30005eb90574a029a6fc81d}{mmc\-\_\-test\-\_\-timeout} ( ) 
\end{DoxySeeAlso}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 66 of file mmc\-\_\-hal.\-c.

\hypertarget{mmc__hal_8c_a120c1501f6694e4947cb37f09679dda9}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-slow@{mmc\-\_\-slow}}
\index{mmc\-\_\-slow@{mmc\-\_\-slow}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-slow}]{\setlength{\rightskip}{0pt plus 5cm}void mmc\-\_\-slow (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_a120c1501f6694e4947cb37f09679dda9}


M\-M\-C set slow S\-P\-I bus speed. 


\begin{DoxyItemize}
\item Used during card detect phase \begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 177 of file mmc\-\_\-hal.\-c.



Referenced by mmc\-\_\-disk\-\_\-initialize(), mmc\-\_\-power\-\_\-on(), and mmc\-\_\-spi\-\_\-init().

\hypertarget{mmc__hal_8c_ae9d8b33ee8fd54f03d5d6946d6022df9}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-spi\-\_\-init@{mmc\-\_\-spi\-\_\-init}}
\index{mmc\-\_\-spi\-\_\-init@{mmc\-\_\-spi\-\_\-init}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-spi\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void mmc\-\_\-spi\-\_\-init (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_ae9d8b33ee8fd54f03d5d6946d6022df9}


M\-M\-C S\-P\-I bus init. 

\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 164 of file mmc\-\_\-hal.\-c.



Referenced by mmc\-\_\-init(), and mmc\-\_\-power\-\_\-on().

\hypertarget{mmc__hal_8c_a00ac994ca5d977f47d3a80432e644499}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-task@{mmc\-\_\-task}}
\index{mmc\-\_\-task@{mmc\-\_\-task}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-task}]{\setlength{\rightskip}{0pt plus 5cm}void mmc\-\_\-task (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_a00ac994ca5d977f47d3a80432e644499}


This function is called every M\-M\-C\-\_\-\-T\-I\-M\-E\-R\-\_\-\-T\-I\-C\-\_\-\-U\-S. 


\begin{DoxyItemize}
\item Monitor timeouts, write protect and card detect status \begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 117 of file mmc\-\_\-hal.\-c.



Referenced by mmc\-\_\-install\-\_\-timer().

\hypertarget{mmc__hal_8c_a21da90d8f30005eb90574a029a6fc81d}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-test\-\_\-timeout@{mmc\-\_\-test\-\_\-timeout}}
\index{mmc\-\_\-test\-\_\-timeout@{mmc\-\_\-test\-\_\-timeout}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-test\-\_\-timeout}]{\setlength{\rightskip}{0pt plus 5cm}int mmc\-\_\-test\-\_\-timeout (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_a21da90d8f30005eb90574a029a6fc81d}


Test M\-M\-C timeout status. 

\begin{DoxySeeAlso}{See Also}
\hyperlink{mmc__hal_8c_ac2daa4c68686d419b1fb7a93df3847a9}{mmc\-\_\-set\-\_\-us\-\_\-timeout()} 

\hyperlink{mmc__hal_8c_adb1cbf0a5ae766b038740c9538497724}{mmc\-\_\-set\-\_\-ms\-\_\-timeout()} 
\end{DoxySeeAlso}
\begin{DoxyReturn}{Returns}
0 still counting 

1 timeout reached 
\end{DoxyReturn}


Definition at line 82 of file mmc\-\_\-hal.\-c.



Referenced by mmc\-\_\-disk\-\_\-initialize(), rcvr\-\_\-datablock(), and wait\-\_\-ready().

\hypertarget{mmc__hal_8c_a4ffa13ede463950ddb818c9ef623538f}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-wp\-\_\-status@{mmc\-\_\-wp\-\_\-status}}
\index{mmc\-\_\-wp\-\_\-status@{mmc\-\_\-wp\-\_\-status}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-wp\-\_\-status}]{\setlength{\rightskip}{0pt plus 5cm}int mmc\-\_\-wp\-\_\-status (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_a4ffa13ede463950ddb818c9ef623538f}


M\-M\-C Card Write Protect status. 


\begin{DoxyItemize}
\item We do not detect card write protect status in this project. \begin{DoxyReturn}{Returns}
0 == not write protected 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 268 of file mmc\-\_\-hal.\-c.



Referenced by amigo\-\_\-request\-\_\-status(), gpib\-\_\-file\-\_\-init(), mmc\-\_\-task(), and S\-S80\-\_\-locate\-\_\-and\-\_\-write().

\hypertarget{mmc__hal_8c_a7c4051db12b5a8afc9bb71b62e50af32}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-xchg\-\_\-spi@{mmc\-\_\-xchg\-\_\-spi}}
\index{mmc\-\_\-xchg\-\_\-spi@{mmc\-\_\-xchg\-\_\-spi}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-xchg\-\_\-spi}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t mmc\-\_\-xchg\-\_\-spi (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{a}
\end{DoxyParamCaption}
)}}\label{mmc__hal_8c_a7c4051db12b5a8afc9bb71b62e50af32}


M\-M\-C S\-P\-I send and receive character. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & Character to send\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
uint8\-\_\-t Received character 
\end{DoxyReturn}
Note\-: when reading only call with 0xff 

Definition at line 154 of file mmc\-\_\-hal.\-c.



Referenced by mmc\-\_\-deselect(), mmc\-\_\-disk\-\_\-initialize(), mmc\-\_\-disk\-\_\-ioctl(), mmc\-\_\-power\-\_\-on(), mmc\-\_\-select(), rcvr\-\_\-datablock(), rcvr\-\_\-spi\-\_\-multi(), send\-\_\-cmd(), wait\-\_\-ready(), xmit\-\_\-datablock(), and xmit\-\_\-spi\-\_\-multi().



\subsection{Variable Documentation}
\hypertarget{mmc__hal_8c_a071dea3cf3cdd93a412bc3a58998799d}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!\-\_\-\-\_\-mmc\-\_\-task\-\_\-timer@{\-\_\-\-\_\-mmc\-\_\-task\-\_\-timer}}
\index{\-\_\-\-\_\-mmc\-\_\-task\-\_\-timer@{\-\_\-\-\_\-mmc\-\_\-task\-\_\-timer}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{\-\_\-\-\_\-mmc\-\_\-task\-\_\-timer}]{\setlength{\rightskip}{0pt plus 5cm}int32\-\_\-t \-\_\-\-\_\-mmc\-\_\-task\-\_\-timer\hspace{0.3cm}{\ttfamily [static]}}}\label{mmc__hal_8c_a071dea3cf3cdd93a412bc3a58998799d}


M\-M\-C Microsecond accumulator for \hyperlink{mmc__hal_8c_a00ac994ca5d977f47d3a80432e644499}{mmc\-\_\-task()} 



Definition at line 107 of file mmc\-\_\-hal.\-c.



Referenced by mmc\-\_\-task().

\hypertarget{mmc__hal_8c_a530d484dee6be1fc954f32f677add7c4}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-init\-\_\-flag@{mmc\-\_\-init\-\_\-flag}}
\index{mmc\-\_\-init\-\_\-flag@{mmc\-\_\-init\-\_\-flag}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-init\-\_\-flag}]{\setlength{\rightskip}{0pt plus 5cm}int mmc\-\_\-init\-\_\-flag = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{mmc__hal_8c_a530d484dee6be1fc954f32f677add7c4}


Definition at line 274 of file mmc\-\_\-hal.\-c.



Referenced by mmc\-\_\-init().

\hypertarget{mmc__hal_8c_ab6838b44b2b3eba0ded1e5196026fd59}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!mmc\-\_\-us\-\_\-timeout@{mmc\-\_\-us\-\_\-timeout}}
\index{mmc\-\_\-us\-\_\-timeout@{mmc\-\_\-us\-\_\-timeout}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{mmc\-\_\-us\-\_\-timeout}]{\setlength{\rightskip}{0pt plus 5cm}volatile int32\-\_\-t mmc\-\_\-us\-\_\-timeout}}\label{mmc__hal_8c_ab6838b44b2b3eba0ded1e5196026fd59}


M\-M\-C timer tic in Microseconds. 

M\-M\-C timeout timer used to detect timeout error conditions 

Definition at line 27 of file mmc\-\_\-hal.\-c.



Referenced by mmc\-\_\-clear\-\_\-timeout(), mmc\-\_\-set\-\_\-ms\-\_\-timeout(), mmc\-\_\-set\-\_\-us\-\_\-timeout(), mmc\-\_\-task(), and mmc\-\_\-test\-\_\-timeout().

\hypertarget{mmc__hal_8c_a5e05b0c3f7ba56fa9c23be08c497eb9f}{\index{mmc\-\_\-hal.\-c@{mmc\-\_\-hal.\-c}!Stat@{Stat}}
\index{Stat@{Stat}!mmc_hal.c@{mmc\-\_\-hal.\-c}}
\subsubsection[{Stat}]{\setlength{\rightskip}{0pt plus 5cm}{\bf D\-S\-T\-A\-T\-U\-S} Stat}}\label{mmc__hal_8c_a5e05b0c3f7ba56fa9c23be08c497eb9f}


M\-M\-C Fat\-Fs insert,write protect status. 



Definition at line 64 of file mmc.\-c.



Referenced by mmc\-\_\-disk\-\_\-initialize(), mmc\-\_\-disk\-\_\-ioctl(), mmc\-\_\-disk\-\_\-read(), mmc\-\_\-disk\-\_\-status(), mmc\-\_\-disk\-\_\-write(), and mmc\-\_\-task().

