\hypertarget{md_README_README}{}\section{R\-E\-A\-D\-M\-E}\label{md_README_README}
\begin{DoxyParagraph}{H\-P85 Disk Emulator Copyright \copyright{} 2014 Mike Gore}
See \hyperlink{md_COPYRIGHT}{C\-O\-P\-Y\-R\-I\-G\-H\-T.md} for a full copywrite notice for the project
\end{DoxyParagraph}
This project emulates three G\-P\-I\-B devices
\begin{DoxyItemize}
\item S\-S80 H\-P9134\-L disk at 700 for my H\-P85\-A (with 85\-A roms)
\item Amigo 9121\-D disk at 710 for my H\-P85\-B (with 85\-B roms)
\item Printer capture at 720 for my H\-P54645\-D scope
\end{DoxyItemize}





\section*{Credits}

{\bfseries I really owe the very existence of this project to the original work done by Anders Gustafsson and his great \char`\"{}\-H\-P Disk Emulator\char`\"{} }
\begin{DoxyItemize}
\item You can visit his project at this site\-:
\begin{DoxyItemize}
\item \href{http://www.dalton.ax/hpdisk}{\tt http\-://www.\-dalton.\-ax/hpdisk}
\item \href{http://www.elektor-labs.com/project/hpdisk-an-sd-based-disk-emulator-for-gpib-instruments-and-computers.13693.html}{\tt http\-://www.\-elektor-\/labs.\-com/project/hpdisk-\/an-\/sd-\/based-\/disk-\/emulator-\/for-\/gpib-\/instruments-\/and-\/computers.\-13693.\-html}
\end{DoxyItemize}
\end{DoxyItemize}

{\bfseries Anders Gustafsson was extremely helpful in providing me his current code and details of his project -\/ which I am very thankful for.}

As mainly a personal excercise in fully understanding the code I ended up rewriting much of the hpdisk project. I did this one part at a time as I learned the protocols and specifications -\/ N\-O\-T because of any problems with his original work.

I have retained Anders H\-P H\-P9121\-D and H\-P9134\-L data structures found in gpib/defines without modification. Although mostly rewritten I have maintained the concept of state machines for G\-P\-I\-B read and write functions as well as for S\-S80 execute state tracking.



 \section*{Abbreviations}

Within this project I have attempted to provide detailed referces to to manuals, listed below. I have included short quotes and section and page\# reference to these works.
\begin{DoxyItemize}
\item {\bfseries S\-S80}
\item {\bfseries C\-S80}
\item {\bfseries A or Amigo}
\item {\bfseries H\-P-\/\-I\-P}
\item {\bfseries H\-P-\/\-I\-P Tutorial}
\end{DoxyItemize}

\subsection*{Documentation References and related sources of information}


\begin{DoxyItemize}
\item Web Resources
\begin{DoxyItemize}
\item \href{http://www.hp9845.net}{\tt http\-://www.\-hp9845.\-net}
\item \href{http://www.hpmuseum.net}{\tt http\-://www.\-hpmuseum.\-net}
\item \href{http://www.hpmusuem.org}{\tt http\-://www.\-hpmusuem.\-org}
\item \href{http://bitsavers.trailing-edge.com}{\tt http\-://bitsavers.\-trailing-\/edge.\-com}
\item \href{http://en.wikipedia.org/wiki/IEEE-488}{\tt http\-://en.\-wikipedia.\-org/wiki/\-I\-E\-E\-E-\/488}
\end{DoxyItemize}
\end{DoxyItemize}

\subsection*{S\-S80 References\-: (\char`\"{}\-S\-S80\char`\"{} is the short form used in the project)}


\begin{DoxyItemize}
\item \char`\"{}\-Subset 80 from Fixed and flexible disc drives\char`\"{}
\item Printed November, 1985
\item H\-P Part\# 5958-\/4129
\end{DoxyItemize}

\subsection*{C\-S80 References\-: (\char`\"{}\-C\-S80\char`\"{} is the short form used in the project)}


\begin{DoxyItemize}
\item \char`\"{}\-C\-S/80 Instruction Set Programming Manual\char`\"{}
\item Printed\-: A\-P\-R 1983
\item H\-P Part\# 5955-\/3442
\end{DoxyItemize}

\subsection*{Amigo References\-: (\char`\"{}\-A\char`\"{} or \char`\"{}\-Amigo\char`\"{} is the short form used in the project)}


\begin{DoxyItemize}
\item \char`\"{}\-Appendix A of 9895\-A Flexible Disc Memory Service Manual\char`\"{}
\item H\-P Part\# 09895-\/90030
\end{DoxyItemize}

\subsection*{H\-P-\/\-I\-B}


\begin{DoxyItemize}
\item (\char`\"{}\-H\-P-\/\-I\-B\char`\"{} is the short form used in the project)
\item \char`\"{}\-Condensed Description of the Hewlett Packard Interface Bus\char`\"{}
\item Printed March 1975
\item H\-P Part\# 59401-\/90030
\end{DoxyItemize}

\subsection*{Tutorial Description of The Hewllet Packard Interface Bus}


\begin{DoxyItemize}
\item (\char`\"{}\-H\-P-\/\-I\-B Tutorial\char`\"{} is the short form used in the project)
\item \href{http://www.hpmemory.org/an/pdf/hp-ib_tutorial_1980.pdf}{\tt http\-://www.\-hpmemory.\-org/an/pdf/hp-\/ib\-\_\-tutorial\-\_\-1980.\-pdf}
\item Printed January 1983
\item \href{http://www.ko4bb.com/Manuals/HP_Agilent/HPIB_tutorial_HP.pdf}{\tt http\-://www.\-ko4bb.\-com/\-Manuals/\-H\-P\-\_\-\-Agilent/\-H\-P\-I\-B\-\_\-tutorial\-\_\-\-H\-P.\-pdf}
\item Printed 1987
\end{DoxyItemize}

\subsection*{G\-P\-I\-B / I\-E\-E\-E 488 Tutorial by Ian Poole}


\begin{DoxyItemize}
\item \href{http://www.radio-electronics.com/info/t_and_m/gpib/ieee488-basics-tutorial.php}{\tt http\-://www.\-radio-\/electronics.\-com/info/t\-\_\-and\-\_\-m/gpib/ieee488-\/basics-\/tutorial.\-php}
\end{DoxyItemize}

\subsection*{H\-P 9133/9134 D/\-H/\-L References}


\begin{DoxyItemize}
\item \char`\"{}\-H\-P 9133/9134 D/\-H/\-L Service Manual\char`\"{}
\item H\-P Part\# 5957-\/6560
\item Printed\-: A\-P\-R\-I\-L 1985, Edition 2
\end{DoxyItemize}

\subsection*{L\-I\-F Filesystem Format}


\begin{DoxyItemize}
\item \href{http://www.hp9845.net/9845/projects/hpdir/#lif_filesystem}{\tt http\-://www.\-hp9845.\-net/9845/projects/hpdir/\#lif\-\_\-filesystem}
\end{DoxyItemize}

\subsection*{Useful Utilities}


\begin{DoxyItemize}
\item H\-P Drive (H\-P Drive Emulators for Windows Platform)
\begin{DoxyItemize}
\item \href{http://www.hp9845.net/9845/projects/hpdrive/}{\tt http\-://www.\-hp9845.\-net/9845/projects/hpdrive/}
\end{DoxyItemize}
\item H\-P Dir (H\-P Drive -\/ Disk Image Manipulation)
\begin{DoxyItemize}
\item \href{http://www.hp9845.net/9845/projects/hpdir/}{\tt http\-://www.\-hp9845.\-net/9845/projects/hpdir/}
\end{DoxyItemize}
\end{DoxyItemize}





\subsection*{G\-P\-I\-B Connector pinout by Anders Gustafsson in his hpdisk project}


\begin{DoxyItemize}
\item \href{http://www.dalton.ax/hpdisk/}{\tt http\-://www.\-dalton.\-ax/hpdisk/}
\end{DoxyItemize}


\begin{DoxyPre}
    Pin Name   Signal Description       Pin Name   Signal Description 
    1   DIO1   Data Input/Output Bit 1  13  DIO5   Data Input/Output Bit 5 
    2   DIO2   Data Input/Output Bit 2  14  DIO6   Data Input/Output Bit 6 
    3   DIO3   Data Input/Output Bit 3  15  DIO7   Data Input/Output Bit 7 
    4   DIO4   Data Input/Output Bit 4  16  DIO8   Data Input/Output Bit 8 
    5   EIO    End-Or-Identify          17  REN    Remote Enable 
    6   DAV    Data Valid               18  Shield Ground (DAV) 
    7   NRFD   Not Ready For Data       19  Shield Ground (NRFD) 
    8   NDAC   Not Data Accepted        20  Shield Ground (NDAC) 
    9   IFC    Interface Clear          21  Shield Ground (IFC) 
    10  SRQ    Service Request          22  Shield Ground (SRQ) 
    11  ATN    Attention                23  Shield Ground (ATN) 
    12  Shield Chassis Ground           24  Single GND Single Ground
\end{DoxyPre}






\subsection*{A\-V\-R A\-T\-M\-E\-G\-A1284\-P pin assignments for H\-P85 Disk}


\begin{DoxyItemize}
\item G\-P\-I\-B\-: Each G\-P\-I\-B pin (8 data and 8 control lines ) attach to C\-P\-U with a 120 ohm current limit resistor .
\begin{DoxyItemize}
\item Each G\-P\-I\-B pin (8 data and 8 control lines ) have a 10\-K pull-\/up resistor to V\-C\-C.
\end{DoxyItemize}
\item I\-S\-P header\-: M\-O\-S\-I,M\-I\-S\-O,S\-C\-K,/\-Reset connects directly to I\-S\-P header
\item Micro S\-D Interface\-: M\-O\-S\-I,M\-I\-S\-O,S\-C\-K attach to C\-P\-U function via a 1k series resistor.
\begin{DoxyItemize}
\item Micro S\-D interface has level shifters and internal 5\-V to 3.\-3\-V regulator
\end{DoxyItemize}
\item R\-S232 T\-T\-L\-: connect to F\-T\-D\-I232 U\-S\-B board which also provides 5\-V V\-C\-C power to all circuits..
\item I2\-C\-: S\-C\-L,S\-D\-A connect to optional D\-S1307 R\-T\-C board with each line having a 2k2 pull-\/up
\end{DoxyItemize}


\begin{DoxyPre}\end{DoxyPre}



\begin{DoxyPre}                       ATMEGA1284P (and ATMEGA644P) 
                       +---V---+ 
     5 EOI INT0  PB0  1|       |40  PA0      D1  1 
     6 DAV INT1  PB1  2|       |39  PA1      D2  2 
       PP  INT2  PB2  3|       |38  PA2      D3  3 
    SD /CS  PWM  PB3  4|       |37  PA3      D4  4 
       NC   PWM  PB4  5|       |36  PA4      D5 13 
    SD     MOSI  PB5  6|       |35  PA5      D6 14 
    SD     MISO  PB6  7|       |34  PA6      D7 15 
    SD      SCK  PB7  8|       |33  PA7      D8 16 
    10K pullup  /RST  9|       |32  AREF     0.1uf 
       +5        VCC 10|       |31  GND      GND   
       GND       GND 11|       |30  AVCC     +5    
    20MHZ      XTAL2 12|       |29  PC7      NC    
    20MHZ      XTAL1 13|       |28  PC6      NC    
       RX   RX0  PD0 14|       |27  PC5  TDI JTAG 
       TX   TX0  PD1 15|       |26  PC4  TDO JTAG 
     7 NRFD RX1  PD2 16|       |25  PC3  TMS JTAG 
     8 NDAC TX1  PD3 17|       |24  PC2  TCK JTAG 
     9 IFC  PWM  PD4 18|       |23  PC1  SDA I2C   
    10 SRQ  PWM  PD5 19|       |22  PC0  SCL I2C  
    11 ATN  PWM  PD6 20|       |21  PD7  PWM REN 17 
                       +-------+ 
\end{DoxyPre}






\subsection*{Parallel Poll Response circuit}


\begin{DoxyItemize}
\item Uses\-: Three chips 74\-H\-C05, 74\-H\-C32, 74\-H\-C595
\item Parallel Poll Response must be less then 2 Microseconds therefore we use hardware to do it!
\end{DoxyItemize}


\begin{DoxyPre}
    ATMEGA               HC595             HC05 
                      +----V----+          +-V-+  
    3 PB3 -------- 12 |RCLK   Q0| 15 -x- 1 |   | 2 --- GPIB D8 
    6 MOSI ------- 14 |SER    Q1| 1  -x- 3 |   | 4 --- GPIB D7 
    8 SCK -------- 11 |SRCLK  Q2| 2  -x- 5 |   | 6 --- GPIB D6 
    9 IFC -------- 10 |SRCLR  Q3| 3  -x- 9 |   | 8 --- GPIB D5 
           HC32       |         |     |    |   | 7 GND 
          +-V-+       |         |     |    |   |14 VCC 
     EOI 2|   |       |         |     |    +---+ 
     ATN 1|   |       |         |     \textbackslash{}--- each line has its own 
          |   | 1--13 |/OE      |          10K resistor to GND 
    VCC 14|   |       |         | 16 VCC 
    GND  7|   |       |         |  8 GND 
          +---+       +---------+ 
\end{DoxyPre}


Notes\-: When both E\-O\-I and A\-T\-N are low the H\-C32 enables H\-C595 outputs
\begin{DoxyItemize}
\item If any H\-C595 output is high the G\-P\-I\-B bus bit will be pulled low
\item I\-F\-C low resets the outputs low 
\end{DoxyItemize}