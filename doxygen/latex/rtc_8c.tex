\hypertarget{rtc_8c}{}\section{hardware/rtc.c File Reference}
\label{rtc_8c}\index{hardware/rtc.\+c@{hardware/rtc.\+c}}


D\+S1307 R\+TC Driver A\+V\+R8.  


{\ttfamily \#include \char`\"{}user\+\_\+config.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}lib/time.\+h\char`\"{}}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
uint8\+\_\+t \hyperlink{rtc_8c_a221016815913bd1b20c9b619900b40b8}{B\+I\+Nto\+B\+CD} (uint8\+\_\+t data)
\begin{DoxyCompactList}\small\item\em Convert number $>$= 0 and $<$= 99 to B\+CD. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{rtc_8c_a2487d4ced293cbe6f2779960032e30c2}{B\+C\+Dto\+B\+IN} (uint8\+\_\+t data)
\begin{DoxyCompactList}\small\item\em Convert two \char`\"{}digit\char`\"{} B\+CD number to binary. \end{DoxyCompactList}\item 
int8\+\_\+t \hyperlink{rtc_8c_a4cc3a3f4decdc4ef7cfb28227e10c36d}{rtc\+\_\+run\+\_\+test} ()
\begin{DoxyCompactList}\small\item\em Check if the D\+S1307 device is running. \end{DoxyCompactList}\item 
int \hyperlink{rtc_8c_a18a3db53342227574822a9b6b9c0386b}{rtc\+\_\+run} (int run)
\begin{DoxyCompactList}\small\item\em Set D\+S1307 run state. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{rtc_8c_aca651806fd67e4d5345fc45f70b35814}{rtc\+\_\+init} (int force, \hyperlink{time_8h_a3346b04b0420b32ccf6b706551b70762}{time\+\_\+t} seconds)
\begin{DoxyCompactList}\small\item\em Initialize D\+S1307 rtc if not initialied -\/ or if forced. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{rtc_8c_a9ba6382e802fb431c0460599c191763f}{rtc\+\_\+write} (\hyperlink{time_8h_a2fea857c30e2c901566fcf45fac68ac5}{tm\+\_\+t} $\ast$t)
\begin{DoxyCompactList}\small\item\em Set D\+S1307 R\+TC from P\+O\+S\+IX struct tm $\ast$ structure. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{rtc_8c_a3794738edaf3a42409aa1d9e12be60c3}{rtc\+\_\+read} (\hyperlink{time_8h_a2fea857c30e2c901566fcf45fac68ac5}{tm\+\_\+t} $\ast$t)
\begin{DoxyCompactList}\small\item\em Read D\+S1307 R\+TC into P\+O\+S\+IX struct tm $\ast$ structure. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
D\+S1307 R\+TC Driver A\+V\+R8. 

\begin{DoxyParagraph}{Edit History}

\begin{DoxyItemize}
\item \mbox{[}1.\+0\mbox{]} \mbox{[}Mike Gore\mbox{]} Initial revision of file.
\end{DoxyItemize}
\end{DoxyParagraph}
\begin{DoxyParagraph}{Copyright \copyright{} 2014-\/2020 Mike Gore, Inc. All rights reserved.}

\end{DoxyParagraph}


\subsection{Function Documentation}
\mbox{\Hypertarget{rtc_8c_a2487d4ced293cbe6f2779960032e30c2}\label{rtc_8c_a2487d4ced293cbe6f2779960032e30c2}} 
\index{rtc.\+c@{rtc.\+c}!B\+C\+Dto\+B\+IN@{B\+C\+Dto\+B\+IN}}
\index{B\+C\+Dto\+B\+IN@{B\+C\+Dto\+B\+IN}!rtc.\+c@{rtc.\+c}}
\subsubsection{\texorpdfstring{B\+C\+Dto\+B\+I\+N()}{BCDtoBIN()}}
{\footnotesize\ttfamily uint8\+\_\+t B\+C\+Dto\+B\+IN (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{data }\end{DoxyParamCaption})}



Convert two \char`\"{}digit\char`\"{} B\+CD number to binary. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em data} & B\+CD number.
\begin{DoxyItemize}
\item number $>$= 0 and $<$= 99 to B\+CD 
\end{DoxyItemize}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Binary value. 
\end{DoxyReturn}


Definition at line 34 of file rtc.\+c.



Referenced by rtc\+\_\+read().

\mbox{\Hypertarget{rtc_8c_a221016815913bd1b20c9b619900b40b8}\label{rtc_8c_a221016815913bd1b20c9b619900b40b8}} 
\index{rtc.\+c@{rtc.\+c}!B\+I\+Nto\+B\+CD@{B\+I\+Nto\+B\+CD}}
\index{B\+I\+Nto\+B\+CD@{B\+I\+Nto\+B\+CD}!rtc.\+c@{rtc.\+c}}
\subsubsection{\texorpdfstring{B\+I\+Nto\+B\+C\+D()}{BINtoBCD()}}
{\footnotesize\ttfamily uint8\+\_\+t B\+I\+Nto\+B\+CD (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{data }\end{DoxyParamCaption})}



Convert number $>$= 0 and $<$= 99 to B\+CD. 


\begin{DoxyItemize}
\item B\+CD format has each hex nibble has a digit 0 .. 9
\end{DoxyItemize}


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em data} & number to convert. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
B\+CD value 
\end{DoxyReturn}
\begin{DoxyWarning}{Warning}
we assume the number is in range. 
\end{DoxyWarning}


Definition at line 23 of file rtc.\+c.



Referenced by rtc\+\_\+write().

\mbox{\Hypertarget{rtc_8c_aca651806fd67e4d5345fc45f70b35814}\label{rtc_8c_aca651806fd67e4d5345fc45f70b35814}} 
\index{rtc.\+c@{rtc.\+c}!rtc\+\_\+init@{rtc\+\_\+init}}
\index{rtc\+\_\+init@{rtc\+\_\+init}!rtc.\+c@{rtc.\+c}}
\subsubsection{\texorpdfstring{rtc\+\_\+init()}{rtc\_init()}}
{\footnotesize\ttfamily uint8\+\_\+t rtc\+\_\+init (\begin{DoxyParamCaption}\item[{int}]{force,  }\item[{\hyperlink{time_8h_a3346b04b0420b32ccf6b706551b70762}{time\+\_\+t}}]{seconds }\end{DoxyParamCaption})}



Initialize D\+S1307 rtc if not initialied -\/ or if forced. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em force} & force initialiation flag.
\begin{DoxyItemize}
\item If 1 then alwasy force initialiation. 
\end{DoxyItemize}\\
\hline
\mbox{\tt in}  & {\em seconds} & P\+O\+S\+IX E\+P\+O\+CH time in seconds.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 on success. 

0 on fail. 
\end{DoxyReturn}


Definition at line 111 of file rtc.\+c.



Referenced by initialize\+\_\+clock(), and setdate\+\_\+r().

\mbox{\Hypertarget{rtc_8c_a3794738edaf3a42409aa1d9e12be60c3}\label{rtc_8c_a3794738edaf3a42409aa1d9e12be60c3}} 
\index{rtc.\+c@{rtc.\+c}!rtc\+\_\+read@{rtc\+\_\+read}}
\index{rtc\+\_\+read@{rtc\+\_\+read}!rtc.\+c@{rtc.\+c}}
\subsubsection{\texorpdfstring{rtc\+\_\+read()}{rtc\_read()}}
{\footnotesize\ttfamily uint8\+\_\+t rtc\+\_\+read (\begin{DoxyParamCaption}\item[{\hyperlink{time_8h_a2fea857c30e2c901566fcf45fac68ac5}{tm\+\_\+t} $\ast$}]{t }\end{DoxyParamCaption})}



Read D\+S1307 R\+TC into P\+O\+S\+IX struct tm $\ast$ structure. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em t} & struct tm $\ast$ P\+O\+S\+IX time returned. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 on sucess. 

0 on fail. 
\end{DoxyReturn}


Definition at line 231 of file rtc.\+c.



Referenced by display\+\_\+clock(), initialize\+\_\+clock(), and rtc\+\_\+read().

\mbox{\Hypertarget{rtc_8c_a18a3db53342227574822a9b6b9c0386b}\label{rtc_8c_a18a3db53342227574822a9b6b9c0386b}} 
\index{rtc.\+c@{rtc.\+c}!rtc\+\_\+run@{rtc\+\_\+run}}
\index{rtc\+\_\+run@{rtc\+\_\+run}!rtc.\+c@{rtc.\+c}}
\subsubsection{\texorpdfstring{rtc\+\_\+run()}{rtc\_run()}}
{\footnotesize\ttfamily int rtc\+\_\+run (\begin{DoxyParamCaption}\item[{int}]{run }\end{DoxyParamCaption})}



Set D\+S1307 run state. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em run} & state.
\begin{DoxyItemize}
\item 1 = run.
\item 0 = stop.
\item -\/1 = check run state.
\end{DoxyItemize}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
run state 0/1 on success. 

-\/1 on error. 
\end{DoxyReturn}


Definition at line 73 of file rtc.\+c.



Referenced by rtc\+\_\+init().

\mbox{\Hypertarget{rtc_8c_a4cc3a3f4decdc4ef7cfb28227e10c36d}\label{rtc_8c_a4cc3a3f4decdc4ef7cfb28227e10c36d}} 
\index{rtc.\+c@{rtc.\+c}!rtc\+\_\+run\+\_\+test@{rtc\+\_\+run\+\_\+test}}
\index{rtc\+\_\+run\+\_\+test@{rtc\+\_\+run\+\_\+test}!rtc.\+c@{rtc.\+c}}
\subsubsection{\texorpdfstring{rtc\+\_\+run\+\_\+test()}{rtc\_run\_test()}}
{\footnotesize\ttfamily int8\+\_\+t rtc\+\_\+run\+\_\+test (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Check if the D\+S1307 device is running. 


\begin{DoxyItemize}
\item display error if read error occurs.
\end{DoxyItemize}

\begin{DoxyReturn}{Returns}
1 if running. 

0 if not running. 
\end{DoxyReturn}


Definition at line 47 of file rtc.\+c.

\mbox{\Hypertarget{rtc_8c_a9ba6382e802fb431c0460599c191763f}\label{rtc_8c_a9ba6382e802fb431c0460599c191763f}} 
\index{rtc.\+c@{rtc.\+c}!rtc\+\_\+write@{rtc\+\_\+write}}
\index{rtc\+\_\+write@{rtc\+\_\+write}!rtc.\+c@{rtc.\+c}}
\subsubsection{\texorpdfstring{rtc\+\_\+write()}{rtc\_write()}}
{\footnotesize\ttfamily uint8\+\_\+t rtc\+\_\+write (\begin{DoxyParamCaption}\item[{\hyperlink{time_8h_a2fea857c30e2c901566fcf45fac68ac5}{tm\+\_\+t} $\ast$}]{t }\end{DoxyParamCaption})}



Set D\+S1307 R\+TC from P\+O\+S\+IX struct tm $\ast$ structure. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em t} & P\+O\+S\+IX struct tm $\ast$ time to set.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 on sucess. 

0 on fail. 
\end{DoxyReturn}


Definition at line 179 of file rtc.\+c.



Referenced by rtc\+\_\+init().

