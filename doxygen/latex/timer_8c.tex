\hypertarget{timer_8c}{\section{lib/timer.c File Reference}
\label{timer_8c}\index{lib/timer.\-c@{lib/timer.\-c}}
}


High resolution timer library and user tasks for A\-V\-R8.  


{\ttfamily \#include $<$hardware/cpu.\-h$>$}\\*
{\ttfamily \#include $<$lib/time.\-h$>$}\\*
{\ttfamily \#include $<$lib/timer.\-h$>$}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{timer_8c_a6c3db6d8efa19f8d102f9a828c8ad6f1}{S\-Y\-S\-T\-E\-M\-\_\-\-H\-Z}~1000\-L
\begin{DoxyCompactList}\small\item\em system interrupt rate in H\-Z \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{timer_8c_ac98c657d442f70782236967f9e0b5457}{init\-\_\-timers} ()
\begin{DoxyCompactList}\small\item\em Setup all timers tasksi and enable interrupts. \end{DoxyCompactList}\item 
void \hyperlink{timer_8c_a67a27354654cf2a2169137adc7274def}{execute\-\_\-timers} ()
\begin{DoxyCompactList}\small\item\em Execute all user timers at S\-Y\-S\-T\-E\-M\-\_\-\-H\-Z rate. \end{DoxyCompactList}\item 
int \hyperlink{timer_8c_a40235216479703e5769682d7849285d5}{set\-\_\-timers} (void($\ast$handler)(void), int timer)
\begin{DoxyCompactList}\small\item\em Install a user timer task. \end{DoxyCompactList}\item 
int \hyperlink{timer_8c_a5d052b86e24a8eb25ce2267307a028a7}{kill\-\_\-timers} (int timer)
\begin{DoxyCompactList}\small\item\em Delete \char`\"{}\-Kill\char`\"{} one user timer task. \end{DoxyCompactList}\item 
void \hyperlink{timer_8c_a3aa9a81614589dad719d6a27c61bed75}{delete\-\_\-all\-\_\-timers} ()
\begin{DoxyCompactList}\small\item\em Clear A\-L\-L user timer tasks. \end{DoxyCompactList}\item 
void \hyperlink{timer_8c_a4afaaa516a452a2d69457d6c80bb0990}{subtract\-\_\-timespec} (\hyperlink{time_8h_a062a82a85c72b4a3020130efc37a00cf}{ts\-\_\-t} $\ast$a, \hyperlink{time_8h_a062a82a85c72b4a3020130efc37a00cf}{ts\-\_\-t} $\ast$b)
\begin{DoxyCompactList}\small\item\em subtract a-\/= b timespec $\ast$ structures. \end{DoxyCompactList}\item 
char $\ast$ \hyperlink{timer_8c_af0eaa6074165a506d2a5bdbc4ac6f360}{ts\-\_\-to\-\_\-str} (\hyperlink{time_8h_a062a82a85c72b4a3020130efc37a00cf}{ts\-\_\-t} $\ast$val)
\item 
void \hyperlink{timer_8c_a2e1028656e05c04f3edf8cd5b907ee9c}{display\-\_\-ts} (\hyperlink{time_8h_a062a82a85c72b4a3020130efc37a00cf}{ts\-\_\-t} $\ast$val)
\begin{DoxyCompactList}\small\item\em timespec structure in seconds.\-nanoseconds. \end{DoxyCompactList}\item 
void \hyperlink{timer_8c_a28bff8f33e0175ce06039b275ef20b0a}{clock\-\_\-elapsed\-\_\-begin} ()
\begin{DoxyCompactList}\small\item\em Store current struct timespec in \-\_\-\-\_\-clock\-\_\-elapsed. \end{DoxyCompactList}\item 
void \hyperlink{timer_8c_a33ff62801548975eb6408da46f67a59d}{clock\-\_\-elapsed\-\_\-end} (char $\ast$msg)
\begin{DoxyCompactList}\small\item\em Subtract and display time difference from clock\-\_\-elapesed\-\_\-begin(). \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{structTIMERS}{T\-I\-M\-E\-R\-S} \hyperlink{timer_8c_ad680b46025f0dae867f27a80344736a1}{timer\-\_\-irq} \mbox{[}\hyperlink{timer_8h_a492a379b00d0ec04be9cd0994e0b42ae}{M\-A\-X\-\_\-\-T\-I\-M\-E\-R\-\_\-\-C\-N\-T}\mbox{]}
\begin{DoxyCompactList}\small\item\em array or user timers \end{DoxyCompactList}\item 
static char \hyperlink{timer_8c_a3b37602023ba3cdbbe1394f43abbef2c}{\-\_\-ts\-\_\-to\-\_\-str} \mbox{[}32\mbox{]}
\begin{DoxyCompactList}\small\item\em timespec structure in seconds.\-nanoseconds in string. \end{DoxyCompactList}\item 
static \hyperlink{time_8h_a062a82a85c72b4a3020130efc37a00cf}{ts\-\_\-t} \hyperlink{timer_8c_a11d81711e20909cf489fb56cbbb81558}{\-\_\-\-\_\-clock\-\_\-elapsed}
\begin{DoxyCompactList}\small\item\em Used for elapsed time calculations. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
High resolution timer library and user tasks for A\-V\-R8. \begin{DoxyParagraph}{Edit History}

\begin{DoxyItemize}
\item \mbox{[}1.\-0\mbox{]} \mbox{[}Mike Gore\mbox{]} Initial revision of file.
\end{DoxyItemize}
\end{DoxyParagraph}
\begin{DoxyParagraph}{Copyright \copyright{} 2014 Mike Gore, Inc. All rights reserved.}

\end{DoxyParagraph}


Definition in file \hyperlink{timer_8c_source}{timer.\-c}.



\subsection{Macro Definition Documentation}
\hypertarget{timer_8c_a6c3db6d8efa19f8d102f9a828c8ad6f1}{\index{timer.\-c@{timer.\-c}!S\-Y\-S\-T\-E\-M\-\_\-\-H\-Z@{S\-Y\-S\-T\-E\-M\-\_\-\-H\-Z}}
\index{S\-Y\-S\-T\-E\-M\-\_\-\-H\-Z@{S\-Y\-S\-T\-E\-M\-\_\-\-H\-Z}!timer.c@{timer.\-c}}
\subsubsection[{S\-Y\-S\-T\-E\-M\-\_\-\-H\-Z}]{\setlength{\rightskip}{0pt plus 5cm}\#define S\-Y\-S\-T\-E\-M\-\_\-\-H\-Z~1000\-L}}\label{timer_8c_a6c3db6d8efa19f8d102f9a828c8ad6f1}


system interrupt rate in H\-Z 



Definition at line 17 of file timer.\-c.



\subsection{Function Documentation}
\hypertarget{timer_8c_a28bff8f33e0175ce06039b275ef20b0a}{\index{timer.\-c@{timer.\-c}!clock\-\_\-elapsed\-\_\-begin@{clock\-\_\-elapsed\-\_\-begin}}
\index{clock\-\_\-elapsed\-\_\-begin@{clock\-\_\-elapsed\-\_\-begin}!timer.c@{timer.\-c}}
\subsubsection[{clock\-\_\-elapsed\-\_\-begin}]{\setlength{\rightskip}{0pt plus 5cm}void clock\-\_\-elapsed\-\_\-begin (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{timer_8c_a28bff8f33e0175ce06039b275ef20b0a}


Store current struct timespec in \-\_\-\-\_\-clock\-\_\-elapsed. 

\begin{DoxySeeAlso}{See Also}
\hyperlink{time_8h_aa84c3231a44cdeb975166c14e0f3cc46}{clock\-\_\-gettime()} P\-O\-S\-I\-X function.
\end{DoxySeeAlso}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 196 of file timer.\-c.



Referenced by delay\-\_\-tests(), and gpib\-\_\-timer\-\_\-elapsed\-\_\-begin().

\hypertarget{timer_8c_a33ff62801548975eb6408da46f67a59d}{\index{timer.\-c@{timer.\-c}!clock\-\_\-elapsed\-\_\-end@{clock\-\_\-elapsed\-\_\-end}}
\index{clock\-\_\-elapsed\-\_\-end@{clock\-\_\-elapsed\-\_\-end}!timer.c@{timer.\-c}}
\subsubsection[{clock\-\_\-elapsed\-\_\-end}]{\setlength{\rightskip}{0pt plus 5cm}void clock\-\_\-elapsed\-\_\-end (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{msg}
\end{DoxyParamCaption}
)}}\label{timer_8c_a33ff62801548975eb6408da46f67a59d}


Subtract and display time difference from clock\-\_\-elapesed\-\_\-begin(). 


\begin{DoxyItemize}
\item Notes\-: Accuracy is a function of timer resolution, C\-P\-U overhead and background tasks.
\end{DoxyItemize}


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em msg} & User message to proceed Time display.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}
\begin{DoxySeeAlso}{See Also}
\hyperlink{time_8h_aa84c3231a44cdeb975166c14e0f3cc46}{clock\-\_\-gettime()}. 

clock\-\_\-elapesed\-\_\-begin(). 
\end{DoxySeeAlso}


Definition at line 211 of file timer.\-c.



Referenced by delay\-\_\-tests(), and gpib\-\_\-timer\-\_\-elapsed\-\_\-end().

\hypertarget{timer_8c_a3aa9a81614589dad719d6a27c61bed75}{\index{timer.\-c@{timer.\-c}!delete\-\_\-all\-\_\-timers@{delete\-\_\-all\-\_\-timers}}
\index{delete\-\_\-all\-\_\-timers@{delete\-\_\-all\-\_\-timers}!timer.c@{timer.\-c}}
\subsubsection[{delete\-\_\-all\-\_\-timers}]{\setlength{\rightskip}{0pt plus 5cm}void delete\-\_\-all\-\_\-timers (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{timer_8c_a3aa9a81614589dad719d6a27c61bed75}


Clear A\-L\-L user timer tasks. 

\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 128 of file timer.\-c.



Referenced by init\-\_\-timers().

\hypertarget{timer_8c_a2e1028656e05c04f3edf8cd5b907ee9c}{\index{timer.\-c@{timer.\-c}!display\-\_\-ts@{display\-\_\-ts}}
\index{display\-\_\-ts@{display\-\_\-ts}!timer.c@{timer.\-c}}
\subsubsection[{display\-\_\-ts}]{\setlength{\rightskip}{0pt plus 5cm}void display\-\_\-ts (
\begin{DoxyParamCaption}
\item[{{\bf ts\-\_\-t} $\ast$}]{val}
\end{DoxyParamCaption}
)}}\label{timer_8c_a2e1028656e05c04f3edf8cd5b907ee9c}


timespec structure in seconds.\-nanoseconds. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em val} & timespec struct we want to display.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}


Definition at line 180 of file timer.\-c.

\hypertarget{timer_8c_a67a27354654cf2a2169137adc7274def}{\index{timer.\-c@{timer.\-c}!execute\-\_\-timers@{execute\-\_\-timers}}
\index{execute\-\_\-timers@{execute\-\_\-timers}!timer.c@{timer.\-c}}
\subsubsection[{execute\-\_\-timers}]{\setlength{\rightskip}{0pt plus 5cm}void execute\-\_\-timers (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{timer_8c_a67a27354654cf2a2169137adc7274def}


Execute all user timers at S\-Y\-S\-T\-E\-M\-\_\-\-H\-Z rate. 

\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 49 of file timer.\-c.



Referenced by I\-S\-R().

\hypertarget{timer_8c_ac98c657d442f70782236967f9e0b5457}{\index{timer.\-c@{timer.\-c}!init\-\_\-timers@{init\-\_\-timers}}
\index{init\-\_\-timers@{init\-\_\-timers}!timer.c@{timer.\-c}}
\subsubsection[{init\-\_\-timers}]{\setlength{\rightskip}{0pt plus 5cm}void init\-\_\-timers (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{timer_8c_ac98c657d442f70782236967f9e0b5457}


Setup all timers tasksi and enable interrupts. 

\begin{DoxySeeAlso}{See Also}
\hyperlink{time_8c_a0b0d519be9cd491fcefa30abf5602219}{clock\-\_\-task()} 

\-: \hyperlink{timer__hal_8c}{timer\-\_\-hal.\-c} for hardware dependent interface
\end{DoxySeeAlso}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}
See \hyperlink{time_8c}{time.\-c}

See \hyperlink{time_8c}{time.\-c} 

Definition at line 29 of file timer.\-c.



Referenced by main().

\hypertarget{timer_8c_a5d052b86e24a8eb25ce2267307a028a7}{\index{timer.\-c@{timer.\-c}!kill\-\_\-timers@{kill\-\_\-timers}}
\index{kill\-\_\-timers@{kill\-\_\-timers}!timer.c@{timer.\-c}}
\subsubsection[{kill\-\_\-timers}]{\setlength{\rightskip}{0pt plus 5cm}int kill\-\_\-timers (
\begin{DoxyParamCaption}
\item[{int}]{timer}
\end{DoxyParamCaption}
)}}\label{timer_8c_a5d052b86e24a8eb25ce2267307a028a7}


Delete \char`\"{}\-Kill\char`\"{} one user timer task. 


\begin{DoxyItemize}
\item \char`\"{}kill\char`\"{} is a common Linux term for ending a process.
\end{DoxyItemize}


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em timer} & user timer task index.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
timer on success. 

-\/1 on error. 
\end{DoxyReturn}


Definition at line 110 of file timer.\-c.

\hypertarget{timer_8c_a40235216479703e5769682d7849285d5}{\index{timer.\-c@{timer.\-c}!set\-\_\-timers@{set\-\_\-timers}}
\index{set\-\_\-timers@{set\-\_\-timers}!timer.c@{timer.\-c}}
\subsubsection[{set\-\_\-timers}]{\setlength{\rightskip}{0pt plus 5cm}int set\-\_\-timers (
\begin{DoxyParamCaption}
\item[{void($\ast$)(void)}]{handler, }
\item[{int}]{timer}
\end{DoxyParamCaption}
)}}\label{timer_8c_a40235216479703e5769682d7849285d5}


Install a user timer task. 


\begin{DoxyItemize}
\item timer argument is unsused, reserved for timer source.
\end{DoxyItemize}


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em handler)} & function pointer to user task. \\
\hline
\mbox{\tt in}  & {\em timer} & reserved for systems with additional low level hardware timers.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
timer on success. 

-\/1 on error. 
\end{DoxyReturn}


Definition at line 71 of file timer.\-c.



Referenced by gpib\-\_\-timer\-\_\-init(), init\-\_\-timers(), and mmc\-\_\-install\-\_\-timer().

\hypertarget{timer_8c_a4afaaa516a452a2d69457d6c80bb0990}{\index{timer.\-c@{timer.\-c}!subtract\-\_\-timespec@{subtract\-\_\-timespec}}
\index{subtract\-\_\-timespec@{subtract\-\_\-timespec}!timer.c@{timer.\-c}}
\subsubsection[{subtract\-\_\-timespec}]{\setlength{\rightskip}{0pt plus 5cm}void subtract\-\_\-timespec (
\begin{DoxyParamCaption}
\item[{{\bf ts\-\_\-t} $\ast$}]{a, }
\item[{{\bf ts\-\_\-t} $\ast$}]{b}
\end{DoxyParamCaption}
)}}\label{timer_8c_a4afaaa516a452a2d69457d6c80bb0990}


subtract a-\/= b timespec $\ast$ structures. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & timespec struct. \\
\hline
\mbox{\tt in}  & {\em b} & timespec struct.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}


Definition at line 148 of file timer.\-c.



Referenced by clock\-\_\-elapsed\-\_\-end().

\hypertarget{timer_8c_af0eaa6074165a506d2a5bdbc4ac6f360}{\index{timer.\-c@{timer.\-c}!ts\-\_\-to\-\_\-str@{ts\-\_\-to\-\_\-str}}
\index{ts\-\_\-to\-\_\-str@{ts\-\_\-to\-\_\-str}!timer.c@{timer.\-c}}
\subsubsection[{ts\-\_\-to\-\_\-str}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ ts\-\_\-to\-\_\-str (
\begin{DoxyParamCaption}
\item[{{\bf ts\-\_\-t} $\ast$}]{val}
\end{DoxyParamCaption}
)}}\label{timer_8c_af0eaa6074165a506d2a5bdbc4ac6f360}


Definition at line 168 of file timer.\-c.



Referenced by clock\-\_\-elapsed\-\_\-end(), and display\-\_\-ts().



\subsection{Variable Documentation}
\hypertarget{timer_8c_a11d81711e20909cf489fb56cbbb81558}{\index{timer.\-c@{timer.\-c}!\-\_\-\-\_\-clock\-\_\-elapsed@{\-\_\-\-\_\-clock\-\_\-elapsed}}
\index{\-\_\-\-\_\-clock\-\_\-elapsed@{\-\_\-\-\_\-clock\-\_\-elapsed}!timer.c@{timer.\-c}}
\subsubsection[{\-\_\-\-\_\-clock\-\_\-elapsed}]{\setlength{\rightskip}{0pt plus 5cm}{\bf ts\-\_\-t} \-\_\-\-\_\-clock\-\_\-elapsed\hspace{0.3cm}{\ttfamily [static]}}}\label{timer_8c_a11d81711e20909cf489fb56cbbb81558}


Used for elapsed time calculations. 

\begin{DoxySeeAlso}{See Also}
\hyperlink{timer_8c_a28bff8f33e0175ce06039b275ef20b0a}{clock\-\_\-elapsed\-\_\-begin()}. 

\hyperlink{timer_8c_a33ff62801548975eb6408da46f67a59d}{clock\-\_\-elapsed\-\_\-end()}. 
\end{DoxySeeAlso}


Definition at line 189 of file timer.\-c.

\hypertarget{timer_8c_a3b37602023ba3cdbbe1394f43abbef2c}{\index{timer.\-c@{timer.\-c}!\-\_\-ts\-\_\-to\-\_\-str@{\-\_\-ts\-\_\-to\-\_\-str}}
\index{\-\_\-ts\-\_\-to\-\_\-str@{\-\_\-ts\-\_\-to\-\_\-str}!timer.c@{timer.\-c}}
\subsubsection[{\-\_\-ts\-\_\-to\-\_\-str}]{\setlength{\rightskip}{0pt plus 5cm}char \-\_\-ts\-\_\-to\-\_\-str\mbox{[}32\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}}\label{timer_8c_a3b37602023ba3cdbbe1394f43abbef2c}


timespec structure in seconds.\-nanoseconds in string. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em } & timespec struct we wish to display. \\
\hline
\mbox{\tt in}  & {\em } & output string.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}


Definition at line 167 of file timer.\-c.

\hypertarget{timer_8c_ad680b46025f0dae867f27a80344736a1}{\index{timer.\-c@{timer.\-c}!timer\-\_\-irq@{timer\-\_\-irq}}
\index{timer\-\_\-irq@{timer\-\_\-irq}!timer.c@{timer.\-c}}
\subsubsection[{timer\-\_\-irq}]{\setlength{\rightskip}{0pt plus 5cm}{\bf T\-I\-M\-E\-R\-S} timer\-\_\-irq\mbox{[}{\bf M\-A\-X\-\_\-\-T\-I\-M\-E\-R\-\_\-\-C\-N\-T}\mbox{]}}}\label{timer_8c_ad680b46025f0dae867f27a80344736a1}


array or user timers 



Definition at line 21 of file timer.\-c.

