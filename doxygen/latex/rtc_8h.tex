\hypertarget{rtc_8h}{}\section{hardware/rtc.h File Reference}
\label{rtc_8h}\index{hardware/rtc.\+h@{hardware/rtc.\+h}}


D\+S1307 R\+TC Driver A\+V\+R8.  


{\ttfamily \#include \char`\"{}user\+\_\+config.\+h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{rtc_8h_aa7571989952421946d1ecd5575584100}{D\+S1307\+\_\+W}~0xd0
\item 
\#define \hyperlink{rtc_8h_a4281d4baba9be3ab3ed9156d89f72fc5}{D\+S1307\+\_\+R}~0xd1
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
uint8\+\_\+t \hyperlink{rtc_8h_a221016815913bd1b20c9b619900b40b8}{B\+I\+Nto\+B\+CD} (uint8\+\_\+t data)
\begin{DoxyCompactList}\small\item\em Convert number $>$= 0 and $<$= 99 to B\+CD. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{rtc_8h_a2487d4ced293cbe6f2779960032e30c2}{B\+C\+Dto\+B\+IN} (uint8\+\_\+t data)
\begin{DoxyCompactList}\small\item\em Convert two \char`\"{}digit\char`\"{} B\+CD number to binary. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{rtc_8h_aca651806fd67e4d5345fc45f70b35814}{rtc\+\_\+init} (int force, \hyperlink{time_8h_a3346b04b0420b32ccf6b706551b70762}{time\+\_\+t} seconds)
\begin{DoxyCompactList}\small\item\em Initialize D\+S1307 rtc if not initialied -\/ or if forced. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{rtc_8h_a27a133715802f5a78c9dfac7d987b35d}{rtc\+\_\+write} (struct \hyperlink{structtm}{tm} $\ast$t)
\begin{DoxyCompactList}\small\item\em Set D\+S1307 R\+TC from P\+O\+S\+IX struct tm $\ast$ structure. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{rtc_8h_a13dd224642e709b435d15f4ea2c58a3e}{rtc\+\_\+read} (struct \hyperlink{structtm}{tm} $\ast$t)
\begin{DoxyCompactList}\small\item\em Read D\+S1307 R\+TC into P\+O\+S\+IX struct tm $\ast$ structure. \end{DoxyCompactList}\item 
uint32\+\_\+t \hyperlink{rtc_8h_a90d310b1f92cf36ef427b8d639e55405}{get\+\_\+fattime} (void)
\begin{DoxyCompactList}\small\item\em Read time and convert to F\+A\+T32 time. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{rtc_8h_a8e105ca35123da90e3d4db81f8848c4a}{rtc\+\_\+ok}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
D\+S1307 R\+TC Driver A\+V\+R8. 

\begin{DoxyParagraph}{Edit History}

\begin{DoxyItemize}
\item \mbox{[}1.\+0\mbox{]} \mbox{[}Mike Gore\mbox{]} Initial revision of file.
\end{DoxyItemize}
\end{DoxyParagraph}
\begin{DoxyParagraph}{Copyright \copyright{} 2014-\/2017 Mike Gore, Inc. All rights reserved.}

\end{DoxyParagraph}


\subsection{Macro Definition Documentation}
\index{rtc.\+h@{rtc.\+h}!D\+S1307\+\_\+R@{D\+S1307\+\_\+R}}
\index{D\+S1307\+\_\+R@{D\+S1307\+\_\+R}!rtc.\+h@{rtc.\+h}}
\subsubsection[{\texorpdfstring{D\+S1307\+\_\+R}{DS1307_R}}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+S1307\+\_\+R~0xd1}\hypertarget{rtc_8h_a4281d4baba9be3ab3ed9156d89f72fc5}{}\label{rtc_8h_a4281d4baba9be3ab3ed9156d89f72fc5}


Definition at line 22 of file rtc.\+h.



Referenced by rtc\+\_\+read(), rtc\+\_\+run(), and rtc\+\_\+run\+\_\+test().

\index{rtc.\+h@{rtc.\+h}!D\+S1307\+\_\+W@{D\+S1307\+\_\+W}}
\index{D\+S1307\+\_\+W@{D\+S1307\+\_\+W}!rtc.\+h@{rtc.\+h}}
\subsubsection[{\texorpdfstring{D\+S1307\+\_\+W}{DS1307_W}}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+S1307\+\_\+W~0xd0}\hypertarget{rtc_8h_aa7571989952421946d1ecd5575584100}{}\label{rtc_8h_aa7571989952421946d1ecd5575584100}


Definition at line 21 of file rtc.\+h.



Referenced by rtc\+\_\+init(), rtc\+\_\+run(), and rtc\+\_\+write().



\subsection{Function Documentation}
\index{rtc.\+h@{rtc.\+h}!B\+C\+Dto\+B\+IN@{B\+C\+Dto\+B\+IN}}
\index{B\+C\+Dto\+B\+IN@{B\+C\+Dto\+B\+IN}!rtc.\+h@{rtc.\+h}}
\subsubsection[{\texorpdfstring{B\+C\+Dto\+B\+I\+N(uint8\+\_\+t data)}{BCDtoBIN(uint8_t data)}}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t B\+C\+Dto\+B\+IN (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{data}
\end{DoxyParamCaption}
)}\hypertarget{rtc_8h_a2487d4ced293cbe6f2779960032e30c2}{}\label{rtc_8h_a2487d4ced293cbe6f2779960032e30c2}


Convert two \char`\"{}digit\char`\"{} B\+CD number to binary. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em data} & B\+CD number.
\begin{DoxyItemize}
\item number $>$= 0 and $<$= 99 to B\+CD 
\end{DoxyItemize}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Binary value. 
\end{DoxyReturn}


Definition at line 34 of file rtc.\+c.



Referenced by rtc\+\_\+read().

\index{rtc.\+h@{rtc.\+h}!B\+I\+Nto\+B\+CD@{B\+I\+Nto\+B\+CD}}
\index{B\+I\+Nto\+B\+CD@{B\+I\+Nto\+B\+CD}!rtc.\+h@{rtc.\+h}}
\subsubsection[{\texorpdfstring{B\+I\+Nto\+B\+C\+D(uint8\+\_\+t data)}{BINtoBCD(uint8_t data)}}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t B\+I\+Nto\+B\+CD (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{data}
\end{DoxyParamCaption}
)}\hypertarget{rtc_8h_a221016815913bd1b20c9b619900b40b8}{}\label{rtc_8h_a221016815913bd1b20c9b619900b40b8}


Convert number $>$= 0 and $<$= 99 to B\+CD. 


\begin{DoxyItemize}
\item B\+CD format has each hex nibble has a digit 0 .. 9
\end{DoxyItemize}


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em data} & number to convert. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
B\+CD value 
\end{DoxyReturn}
\begin{DoxyWarning}{Warning}
we assume the number is in range. 
\end{DoxyWarning}


Definition at line 23 of file rtc.\+c.



Referenced by rtc\+\_\+write().

\index{rtc.\+h@{rtc.\+h}!get\+\_\+fattime@{get\+\_\+fattime}}
\index{get\+\_\+fattime@{get\+\_\+fattime}!rtc.\+h@{rtc.\+h}}
\subsubsection[{\texorpdfstring{get\+\_\+fattime(void)}{get_fattime(void)}}]{\setlength{\rightskip}{0pt plus 5cm}uint32\+\_\+t get\+\_\+fattime (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\hypertarget{rtc_8h_a90d310b1f92cf36ef427b8d639e55405}{}\label{rtc_8h_a90d310b1f92cf36ef427b8d639e55405}


Read time and convert to F\+A\+T32 time. 

\begin{DoxyReturn}{Returns}
F\+A\+T32 time. 
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\hyperlink{fatfs__sup_8c_ae7b9417320aaaa1c1dfb229cad6669d8}{tm\+\_\+to\+\_\+fat()}. 
\end{DoxySeeAlso}


Definition at line 126 of file fatfs\+\_\+sup.\+c.



Referenced by rtc\+\_\+read().

\index{rtc.\+h@{rtc.\+h}!rtc\+\_\+init@{rtc\+\_\+init}}
\index{rtc\+\_\+init@{rtc\+\_\+init}!rtc.\+h@{rtc.\+h}}
\subsubsection[{\texorpdfstring{rtc\+\_\+init(int force, time\+\_\+t seconds)}{rtc_init(int force, time_t seconds)}}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t rtc\+\_\+init (
\begin{DoxyParamCaption}
\item[{int}]{force, }
\item[{{\bf time\+\_\+t}}]{seconds}
\end{DoxyParamCaption}
)}\hypertarget{rtc_8h_aca651806fd67e4d5345fc45f70b35814}{}\label{rtc_8h_aca651806fd67e4d5345fc45f70b35814}


Initialize D\+S1307 rtc if not initialied -\/ or if forced. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em force} & force initialiation flag.
\begin{DoxyItemize}
\item If 1 then alwasy force initialiation. 
\end{DoxyItemize}\\
\hline
\mbox{\tt in}  & {\em seconds} & P\+O\+S\+IX E\+P\+O\+CH time in seconds.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 on success. 

0 on fail. 
\end{DoxyReturn}


Definition at line 111 of file rtc.\+c.



Referenced by initialize\+\_\+clock(), and setdate\+\_\+r().

\index{rtc.\+h@{rtc.\+h}!rtc\+\_\+read@{rtc\+\_\+read}}
\index{rtc\+\_\+read@{rtc\+\_\+read}!rtc.\+h@{rtc.\+h}}
\subsubsection[{\texorpdfstring{rtc\+\_\+read(struct tm $\ast$t)}{rtc_read(struct tm *t)}}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t rtc\+\_\+read (
\begin{DoxyParamCaption}
\item[{{\bf tm\+\_\+t} $\ast$}]{t}
\end{DoxyParamCaption}
)}\hypertarget{rtc_8h_a13dd224642e709b435d15f4ea2c58a3e}{}\label{rtc_8h_a13dd224642e709b435d15f4ea2c58a3e}


Read D\+S1307 R\+TC into P\+O\+S\+IX struct tm $\ast$ structure. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em t} & struct tm $\ast$ P\+O\+S\+IX time returned. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 on sucess. 

0 on fail. 
\end{DoxyReturn}


Definition at line 231 of file rtc.\+c.



Referenced by display\+\_\+clock(), initialize\+\_\+clock(), and rtc\+\_\+read().

\index{rtc.\+h@{rtc.\+h}!rtc\+\_\+write@{rtc\+\_\+write}}
\index{rtc\+\_\+write@{rtc\+\_\+write}!rtc.\+h@{rtc.\+h}}
\subsubsection[{\texorpdfstring{rtc\+\_\+write(struct tm $\ast$t)}{rtc_write(struct tm *t)}}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t rtc\+\_\+write (
\begin{DoxyParamCaption}
\item[{{\bf tm\+\_\+t} $\ast$}]{t}
\end{DoxyParamCaption}
)}\hypertarget{rtc_8h_a27a133715802f5a78c9dfac7d987b35d}{}\label{rtc_8h_a27a133715802f5a78c9dfac7d987b35d}


Set D\+S1307 R\+TC from P\+O\+S\+IX struct tm $\ast$ structure. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em t} & P\+O\+S\+IX struct tm $\ast$ time to set.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 on sucess. 

0 on fail. 
\end{DoxyReturn}


Definition at line 179 of file rtc.\+c.



Referenced by rtc\+\_\+init().



\subsection{Variable Documentation}
\index{rtc.\+h@{rtc.\+h}!rtc\+\_\+ok@{rtc\+\_\+ok}}
\index{rtc\+\_\+ok@{rtc\+\_\+ok}!rtc.\+h@{rtc.\+h}}
\subsubsection[{\texorpdfstring{rtc\+\_\+ok}{rtc_ok}}]{\setlength{\rightskip}{0pt plus 5cm}int rtc\+\_\+ok}\hypertarget{rtc_8h_a8e105ca35123da90e3d4db81f8848c4a}{}\label{rtc_8h_a8e105ca35123da90e3d4db81f8848c4a}


Definition at line 19 of file rtc.\+h.



Referenced by rtc\+\_\+init().

