\hypertarget{rtc_8h}{}\doxysection{hardware/rtc.h File Reference}
\label{rtc_8h}\index{hardware/rtc.h@{hardware/rtc.h}}


D\+S1307 R\+TC Driver A\+V\+R8.  


{\ttfamily \#include \char`\"{}user\+\_\+config.\+h\char`\"{}}\newline
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{rtc_8h_a3925233b7b37e63f8555ec63d941c847}{D\+S1307}}~0x68
\item 
\#define \mbox{\hyperlink{rtc_8h_a6d3e4a0c5571bf61e7acb8399a735469}{D\+S1307\+\_\+\+R\+E\+G\+\_\+\+S\+I\+ZE}}~8
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
uint8\+\_\+t \mbox{\hyperlink{rtc_8h_a221016815913bd1b20c9b619900b40b8}{B\+I\+Nto\+B\+CD}} (uint8\+\_\+t data)
\begin{DoxyCompactList}\small\item\em R\+TC B\+CD conversion functions. \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{rtc_8h_a2487d4ced293cbe6f2779960032e30c2}{B\+C\+Dto\+B\+IN}} (uint8\+\_\+t data)
\begin{DoxyCompactList}\small\item\em Convert two \char`\"{}digit\char`\"{} B\+CD number to binary. \end{DoxyCompactList}\item 
int8\+\_\+t \mbox{\hyperlink{rtc_8h_a5838fb934d7e35fcd257d777b75faba8}{i2c\+\_\+rtc\+\_\+write}} (uint8\+\_\+t address, uint8\+\_\+t ind, uint8\+\_\+t $\ast$buf, uint8\+\_\+t len)
\begin{DoxyCompactList}\small\item\em R\+TC H\+AL. \end{DoxyCompactList}\item 
int8\+\_\+t \mbox{\hyperlink{rtc_8h_a8092c3d5695d288cf48cf92483c8f9fb}{i2c\+\_\+rtc\+\_\+read}} (uint8\+\_\+t address, uint8\+\_\+t ind, uint8\+\_\+t $\ast$buf, uint8\+\_\+t len)
\begin{DoxyCompactList}\small\item\em R\+TC I2C R\+E\+AD function. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{rtc_8h_a48dd2c77e27ab039e69d3b00fa145196}{i2c\+\_\+rtc\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em R\+TC I2C initialization code. \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{rtc_8h_a9ba6382e802fb431c0460599c191763f}{rtc\+\_\+write}} (\mbox{\hyperlink{time_8h_a2fea857c30e2c901566fcf45fac68ac5}{tm\+\_\+t}} $\ast$t)
\begin{DoxyCompactList}\small\item\em R\+TC functions. \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{rtc_8h_a3794738edaf3a42409aa1d9e12be60c3}{rtc\+\_\+read}} (\mbox{\hyperlink{time_8h_a2fea857c30e2c901566fcf45fac68ac5}{tm\+\_\+t}} $\ast$t)
\begin{DoxyCompactList}\small\item\em Read D\+S1307 R\+TC into P\+O\+S\+IX struct tm $\ast$ structure. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{rtc_8h_a18a3db53342227574822a9b6b9c0386b}{rtc\+\_\+run}} (int run)
\begin{DoxyCompactList}\small\item\em Set D\+S1307 run state. \end{DoxyCompactList}\item 
int8\+\_\+t \mbox{\hyperlink{rtc_8h_aa4e884598c090bd900bb77a683ecfd20}{rtc\+\_\+run\+\_\+test}} (void)
\begin{DoxyCompactList}\small\item\em D\+S1307 run test. \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{rtc_8h_aca651806fd67e4d5345fc45f70b35814}{rtc\+\_\+init}} (int force, \mbox{\hyperlink{time_8h_a3346b04b0420b32ccf6b706551b70762}{time\+\_\+t}} seconds)
\begin{DoxyCompactList}\small\item\em Initialize D\+S1307 rtc if not initialied -\/ or if forced. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{rtc_8h_a8e105ca35123da90e3d4db81f8848c4a}{rtc\+\_\+ok}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
D\+S1307 R\+TC Driver A\+V\+R8. 

\begin{DoxyParagraph}{Edit History}

\begin{DoxyItemize}
\item \mbox{[}1.\+0\mbox{]} \mbox{[}Mike Gore\mbox{]} Initial revision of file.
\end{DoxyItemize}
\end{DoxyParagraph}
\begin{DoxyParagraph}{Copyright \copyright{} 2014-\/2020 Mike Gore, Inc. All rights reserved.}

\end{DoxyParagraph}


\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{rtc_8h_a3925233b7b37e63f8555ec63d941c847}\label{rtc_8h_a3925233b7b37e63f8555ec63d941c847}} 
\index{rtc.h@{rtc.h}!DS1307@{DS1307}}
\index{DS1307@{DS1307}!rtc.h@{rtc.h}}
\doxysubsubsection{\texorpdfstring{DS1307}{DS1307}}
{\footnotesize\ttfamily \#define D\+S1307~0x68}



Definition at line 20 of file rtc.\+h.

\mbox{\Hypertarget{rtc_8h_a6d3e4a0c5571bf61e7acb8399a735469}\label{rtc_8h_a6d3e4a0c5571bf61e7acb8399a735469}} 
\index{rtc.h@{rtc.h}!DS1307\_REG\_SIZE@{DS1307\_REG\_SIZE}}
\index{DS1307\_REG\_SIZE@{DS1307\_REG\_SIZE}!rtc.h@{rtc.h}}
\doxysubsubsection{\texorpdfstring{DS1307\_REG\_SIZE}{DS1307\_REG\_SIZE}}
{\footnotesize\ttfamily \#define D\+S1307\+\_\+\+R\+E\+G\+\_\+\+S\+I\+ZE~8}



Definition at line 21 of file rtc.\+h.



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{rtc_8h_a2487d4ced293cbe6f2779960032e30c2}\label{rtc_8h_a2487d4ced293cbe6f2779960032e30c2}} 
\index{rtc.h@{rtc.h}!BCDtoBIN@{BCDtoBIN}}
\index{BCDtoBIN@{BCDtoBIN}!rtc.h@{rtc.h}}
\doxysubsubsection{\texorpdfstring{BCDtoBIN()}{BCDtoBIN()}}
{\footnotesize\ttfamily uint8\+\_\+t B\+C\+Dto\+B\+IN (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{data }\end{DoxyParamCaption})}



Convert two \char`\"{}digit\char`\"{} B\+CD number to binary. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em data} & B\+CD number.
\begin{DoxyItemize}
\item number $>$= 0 and $<$= 99 to B\+CD 
\end{DoxyItemize}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Binary value. 
\end{DoxyReturn}


Definition at line 38 of file rtc.\+c.



Referenced by rtc\+\_\+read().

\mbox{\Hypertarget{rtc_8h_a221016815913bd1b20c9b619900b40b8}\label{rtc_8h_a221016815913bd1b20c9b619900b40b8}} 
\index{rtc.h@{rtc.h}!BINtoBCD@{BINtoBCD}}
\index{BINtoBCD@{BINtoBCD}!rtc.h@{rtc.h}}
\doxysubsubsection{\texorpdfstring{BINtoBCD()}{BINtoBCD()}}
{\footnotesize\ttfamily uint8\+\_\+t B\+I\+Nto\+B\+CD (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{data }\end{DoxyParamCaption})}



R\+TC B\+CD conversion functions. 

================================================================================

Convert number $>$= 0 and $<$= 99 to B\+CD.


\begin{DoxyItemize}
\item B\+CD format has each hex nibble has a digit 0 .. 9
\end{DoxyItemize}


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em data} & number to convert. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
B\+CD value 
\end{DoxyReturn}
\begin{DoxyWarning}{Warning}
we assume the number is in range. 
\end{DoxyWarning}


Definition at line 27 of file rtc.\+c.



Referenced by rtc\+\_\+write().

\mbox{\Hypertarget{rtc_8h_a48dd2c77e27ab039e69d3b00fa145196}\label{rtc_8h_a48dd2c77e27ab039e69d3b00fa145196}} 
\index{rtc.h@{rtc.h}!i2c\_rtc\_init@{i2c\_rtc\_init}}
\index{i2c\_rtc\_init@{i2c\_rtc\_init}!rtc.h@{rtc.h}}
\doxysubsubsection{\texorpdfstring{i2c\_rtc\_init()}{i2c\_rtc\_init()}}
{\footnotesize\ttfamily void i2c\+\_\+rtc\+\_\+init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



R\+TC I2C initialization code. 

\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 123 of file rtc.\+c.



Referenced by rtc\+\_\+init().

\mbox{\Hypertarget{rtc_8h_a8092c3d5695d288cf48cf92483c8f9fb}\label{rtc_8h_a8092c3d5695d288cf48cf92483c8f9fb}} 
\index{rtc.h@{rtc.h}!i2c\_rtc\_read@{i2c\_rtc\_read}}
\index{i2c\_rtc\_read@{i2c\_rtc\_read}!rtc.h@{rtc.h}}
\doxysubsubsection{\texorpdfstring{i2c\_rtc\_read()}{i2c\_rtc\_read()}}
{\footnotesize\ttfamily int8\+\_\+t i2c\+\_\+rtc\+\_\+read (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{address,  }\item[{uint8\+\_\+t}]{index,  }\item[{uint8\+\_\+t $\ast$}]{buf,  }\item[{uint8\+\_\+t}]{len }\end{DoxyParamCaption})}



R\+TC I2C R\+E\+AD function. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em address} & D\+S1307 I2C address \\
\hline
\mbox{\texttt{ in}}  & {\em index} & D\+S1307 internal address index pointer \\
\hline
\mbox{\texttt{ out}}  & {\em buf} & read buffer \\
\hline
\mbox{\texttt{ in}}  & {\em len} & buffer length\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 = OK, 0 = E\+R\+R\+OR 
\end{DoxyReturn}


Definition at line 90 of file rtc.\+c.



Referenced by rtc\+\_\+read(), and rtc\+\_\+run().

\mbox{\Hypertarget{rtc_8h_a5838fb934d7e35fcd257d777b75faba8}\label{rtc_8h_a5838fb934d7e35fcd257d777b75faba8}} 
\index{rtc.h@{rtc.h}!i2c\_rtc\_write@{i2c\_rtc\_write}}
\index{i2c\_rtc\_write@{i2c\_rtc\_write}!rtc.h@{rtc.h}}
\doxysubsubsection{\texorpdfstring{i2c\_rtc\_write()}{i2c\_rtc\_write()}}
{\footnotesize\ttfamily int8\+\_\+t i2c\+\_\+rtc\+\_\+write (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{address,  }\item[{uint8\+\_\+t}]{index,  }\item[{uint8\+\_\+t $\ast$}]{buf,  }\item[{uint8\+\_\+t}]{len }\end{DoxyParamCaption})}



R\+TC H\+AL. 

================================================================================

R\+TC I2C W\+R\+I\+TE function 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em address} & D\+S1307 I2C address \\
\hline
\mbox{\texttt{ in}}  & {\em index} & D\+S1307 internal address index pointer \\
\hline
\mbox{\texttt{ out}}  & {\em buf} & write buffer \\
\hline
\mbox{\texttt{ in}}  & {\em len} & buffer length\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 = OK, 0 = E\+R\+R\+OR 
\end{DoxyReturn}
D\+S1307 internal Address Pointer

Definition at line 55 of file rtc.\+c.



Referenced by rtc\+\_\+run(), and rtc\+\_\+write().

\mbox{\Hypertarget{rtc_8h_aca651806fd67e4d5345fc45f70b35814}\label{rtc_8h_aca651806fd67e4d5345fc45f70b35814}} 
\index{rtc.h@{rtc.h}!rtc\_init@{rtc\_init}}
\index{rtc\_init@{rtc\_init}!rtc.h@{rtc.h}}
\doxysubsubsection{\texorpdfstring{rtc\_init()}{rtc\_init()}}
{\footnotesize\ttfamily uint8\+\_\+t rtc\+\_\+init (\begin{DoxyParamCaption}\item[{int}]{force,  }\item[{\mbox{\hyperlink{time_8h_a3346b04b0420b32ccf6b706551b70762}{time\+\_\+t}}}]{seconds }\end{DoxyParamCaption})}



Initialize D\+S1307 rtc if not initialied -\/ or if forced. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em force} & force initialiation flag.
\begin{DoxyItemize}
\item If 1 then alwasy force initialiation. 
\end{DoxyItemize}\\
\hline
\mbox{\texttt{ in}}  & {\em seconds} & P\+O\+S\+IX E\+P\+O\+CH time in seconds.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
run state 0 = S\+T\+OP, 1 = R\+UN 

-\/1 = E\+R\+R\+OR 
\end{DoxyReturn}


Definition at line 285 of file rtc.\+c.



Referenced by initialize\+\_\+clock(), and setdate\+\_\+r().

\mbox{\Hypertarget{rtc_8h_a3794738edaf3a42409aa1d9e12be60c3}\label{rtc_8h_a3794738edaf3a42409aa1d9e12be60c3}} 
\index{rtc.h@{rtc.h}!rtc\_read@{rtc\_read}}
\index{rtc\_read@{rtc\_read}!rtc.h@{rtc.h}}
\doxysubsubsection{\texorpdfstring{rtc\_read()}{rtc\_read()}}
{\footnotesize\ttfamily uint8\+\_\+t rtc\+\_\+read (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{time_8h_a2fea857c30e2c901566fcf45fac68ac5}{tm\+\_\+t}} $\ast$}]{t }\end{DoxyParamCaption})}



Read D\+S1307 R\+TC into P\+O\+S\+IX struct tm $\ast$ structure. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em t} & struct tm $\ast$ P\+O\+S\+IX time returned. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 on sucess. 

0 on fail. 
\end{DoxyReturn}


Definition at line 189 of file rtc.\+c.



Referenced by display\+\_\+clock(), and initialize\+\_\+clock().

\mbox{\Hypertarget{rtc_8h_a18a3db53342227574822a9b6b9c0386b}\label{rtc_8h_a18a3db53342227574822a9b6b9c0386b}} 
\index{rtc.h@{rtc.h}!rtc\_run@{rtc\_run}}
\index{rtc\_run@{rtc\_run}!rtc.h@{rtc.h}}
\doxysubsubsection{\texorpdfstring{rtc\_run()}{rtc\_run()}}
{\footnotesize\ttfamily int rtc\+\_\+run (\begin{DoxyParamCaption}\item[{int}]{run }\end{DoxyParamCaption})}



Set D\+S1307 run state. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em run} & state.
\begin{DoxyItemize}
\item 1 = run.
\item 0 = stop.
\item -\/1 = check run state.
\end{DoxyItemize}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
run state 0/1 on success. 

-\/1 on error. 
\end{DoxyReturn}


Definition at line 240 of file rtc.\+c.



Referenced by rtc\+\_\+init(), and rtc\+\_\+run\+\_\+test().

\mbox{\Hypertarget{rtc_8h_aa4e884598c090bd900bb77a683ecfd20}\label{rtc_8h_aa4e884598c090bd900bb77a683ecfd20}} 
\index{rtc.h@{rtc.h}!rtc\_run\_test@{rtc\_run\_test}}
\index{rtc\_run\_test@{rtc\_run\_test}!rtc.h@{rtc.h}}
\doxysubsubsection{\texorpdfstring{rtc\_run\_test()}{rtc\_run\_test()}}
{\footnotesize\ttfamily int8\+\_\+t rtc\+\_\+run\+\_\+test (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



D\+S1307 run test. 


\begin{DoxyItemize}
\item display error if read error occurs.
\end{DoxyItemize}

\begin{DoxyReturn}{Returns}
1 if running. 

0 if not running. 

-\/1 E\+R\+R\+OR 
\end{DoxyReturn}


Definition at line 271 of file rtc.\+c.

\mbox{\Hypertarget{rtc_8h_a9ba6382e802fb431c0460599c191763f}\label{rtc_8h_a9ba6382e802fb431c0460599c191763f}} 
\index{rtc.h@{rtc.h}!rtc\_write@{rtc\_write}}
\index{rtc\_write@{rtc\_write}!rtc.h@{rtc.h}}
\doxysubsubsection{\texorpdfstring{rtc\_write()}{rtc\_write()}}
{\footnotesize\ttfamily uint8\+\_\+t rtc\+\_\+write (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{time_8h_a2fea857c30e2c901566fcf45fac68ac5}{tm\+\_\+t}} $\ast$}]{t }\end{DoxyParamCaption})}



R\+TC functions. 

================================================================================

Set D\+S1307 R\+TC from P\+O\+S\+IX struct tm $\ast$ structure.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em t} & P\+O\+S\+IX struct tm $\ast$ time to set.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 on sucess. 

0 on fail. 
\end{DoxyReturn}


Definition at line 138 of file rtc.\+c.



Referenced by rtc\+\_\+init().



\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{rtc_8h_a8e105ca35123da90e3d4db81f8848c4a}\label{rtc_8h_a8e105ca35123da90e3d4db81f8848c4a}} 
\index{rtc.h@{rtc.h}!rtc\_ok@{rtc\_ok}}
\index{rtc\_ok@{rtc\_ok}!rtc.h@{rtc.h}}
\doxysubsubsection{\texorpdfstring{rtc\_ok}{rtc\_ok}}
{\footnotesize\ttfamily int rtc\+\_\+ok}



Definition at line 18 of file rtc.\+h.



Referenced by rtc\+\_\+init().

