\hypertarget{spi_8c}{\section{hardware/spi.c File Reference}
\label{spi_8c}\index{hardware/spi.\-c@{hardware/spi.\-c}}
}


S\-P\-I Driver A\-V\-R8.  


{\ttfamily \#include \char`\"{}user\-\_\-config.\-h\char`\"{}}\\*
{\ttfamily \#include $<$stdlib.\-h$>$}\\*
{\ttfamily \#include \char`\"{}spi.\-h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{spi_8c_a4b8379d9d83e3283bb53cfeca92f2e02}{S\-P\-I0\-\_\-\-Speed} (uint32\-\_\-t speed)
\begin{DoxyCompactList}\small\item\em Set A\-V\-R S\-P\-I bus rate in H\-Z. \end{DoxyCompactList}\item 
uint32\-\_\-t \hyperlink{spi_8c_a6b19a886a9e63fbc9ed02a6a6361e68b}{S\-P\-I0\-\_\-\-Get\-\_\-\-Speed} (void)
\begin{DoxyCompactList}\small\item\em Return previously saved S\-P\-I B\-U\-S rate in H\-Z. \end{DoxyCompactList}\item 
void \hyperlink{spi_8c_a50834bfd8ff3e59840ef35d5283f5306}{S\-P\-I0\-\_\-\-Mode} (int mode)
\begin{DoxyCompactList}\small\item\em Set S\-P\-I clock mode. \end{DoxyCompactList}\item 
int \hyperlink{spi_8c_ab93aed2163d123a27c97758c8cde0587}{S\-P\-I0\-\_\-\-Get\-\_\-\-Mode} (void)
\begin{DoxyCompactList}\small\item\em Return saved S\-P\-I mode as set by \hyperlink{spi_8c_a50834bfd8ff3e59840ef35d5283f5306}{S\-P\-I0\-\_\-\-Mode()}. \end{DoxyCompactList}\item 
void \hyperlink{spi_8c_a09a39e7befac69f184fd466e10730595}{S\-P\-I0\-\_\-\-Init} (uint32\-\_\-t speed)
\begin{DoxyCompactList}\small\item\em Initialize S\-P\-I0 device. \end{DoxyCompactList}\item 
uint8\-\_\-t \hyperlink{spi_8c_a795b3fa18e16d366d9a64e88f1cb18ab}{S\-P\-I0\-\_\-\-T\-X\-R\-X\-\_\-\-Byte} (uint8\-\_\-t Data)
\begin{DoxyCompactList}\small\item\em S\-P\-I read/\-Write byte. \end{DoxyCompactList}\item 
void \hyperlink{spi_8c_a491de3187a3fd4b12dfc1f7fbd50238f}{S\-P\-I0\-\_\-\-T\-X} (uint8\-\_\-t $\ast$data, int count)
\begin{DoxyCompactList}\small\item\em S\-P\-I buffered write functions. \end{DoxyCompactList}\item 
void \hyperlink{spi_8c_a7b56f3fcfe9a88adaac0c59465c0e845}{S\-P\-I0\-\_\-\-T\-X\-R\-X} (uint8\-\_\-t $\ast$data, int count)
\begin{DoxyCompactList}\small\item\em H\-S\-P\-I write and read using F\-I\-F\-O. \end{DoxyCompactList}\item 
void \hyperlink{spi_8c_a8e36c17c5822efaecdbcc75829f7582e}{S\-P\-I0\-\_\-\-R\-X} (uint8\-\_\-t $\ast$data, int count)
\begin{DoxyCompactList}\small\item\em H\-S\-P\-I read using F\-I\-F\-O. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{spi_8c_a7c077b6fe081793cd1e55509f7284334}{\-\_\-\-S\-P\-I0\-\_\-init\-\_\-done} = 0
\item 
static uint32\-\_\-t \hyperlink{spi_8c_a27ad9c881de03a6b8defda1bde93566f}{S\-P\-I0\-\_\-\-Speed\-\_\-value} = 0
\begin{DoxyCompactList}\small\item\em Saved S\-P\-I bus speed. \end{DoxyCompactList}\item 
static int \hyperlink{spi_8c_ae41154cf3f834c2d151bfa9e67cfc402}{S\-P\-I0\-\_\-\-Mode\-\_\-value} = 0
\begin{DoxyCompactList}\small\item\em Saved S\-P\-I Mode. \end{DoxyCompactList}\item 
static int \hyperlink{spi_8c_a4d167d8fd3bcfa0504b201183b94449b}{S\-P\-I0\-\_\-\-Init\-\_\-state} = 0
\begin{DoxyCompactList}\small\item\em S\-P\-I0 initialization flag. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
S\-P\-I Driver A\-V\-R8. \begin{DoxyParagraph}{Edit History}

\begin{DoxyItemize}
\item \mbox{[}1.\-0\mbox{]} \mbox{[}Mike Gore\mbox{]} Initial revision of file.
\end{DoxyItemize}
\end{DoxyParagraph}
\begin{DoxyCopyright}{Copyright}
Copyright \copyright{} 2014 Mike Gore, Inc. All rights reserved.

G\-N\-U Public License.
\end{DoxyCopyright}
\begin{DoxyAuthor}{Author}
Mike Gore 
\end{DoxyAuthor}


Definition in file \hyperlink{spi_8c_source}{spi.\-c}.



\subsection{Function Documentation}
\hypertarget{spi_8c_ab93aed2163d123a27c97758c8cde0587}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Get\-\_\-\-Mode@{S\-P\-I0\-\_\-\-Get\-\_\-\-Mode}}
\index{S\-P\-I0\-\_\-\-Get\-\_\-\-Mode@{S\-P\-I0\-\_\-\-Get\-\_\-\-Mode}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Get\-\_\-\-Mode}]{\setlength{\rightskip}{0pt plus 5cm}int S\-P\-I0\-\_\-\-Get\-\_\-\-Mode (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{spi_8c_ab93aed2163d123a27c97758c8cde0587}


Return saved S\-P\-I mode as set by \hyperlink{spi_8c_a50834bfd8ff3e59840ef35d5283f5306}{S\-P\-I0\-\_\-\-Mode()}. 

\begin{DoxyReturn}{Returns}
saved mode. 
\end{DoxyReturn}


Definition at line 220 of file spi.\-c.

\hypertarget{spi_8c_a6b19a886a9e63fbc9ed02a6a6361e68b}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Get\-\_\-\-Speed@{S\-P\-I0\-\_\-\-Get\-\_\-\-Speed}}
\index{S\-P\-I0\-\_\-\-Get\-\_\-\-Speed@{S\-P\-I0\-\_\-\-Get\-\_\-\-Speed}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Get\-\_\-\-Speed}]{\setlength{\rightskip}{0pt plus 5cm}uint32\-\_\-t S\-P\-I0\-\_\-\-Get\-\_\-\-Speed (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{spi_8c_a6b19a886a9e63fbc9ed02a6a6361e68b}


Return previously saved S\-P\-I B\-U\-S rate in H\-Z. 

\begin{DoxyReturn}{Returns}
S\-P\-I clock rate in H\-Z. 
\end{DoxyReturn}


Definition at line 168 of file spi.\-c.

\hypertarget{spi_8c_a09a39e7befac69f184fd466e10730595}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Init@{S\-P\-I0\-\_\-\-Init}}
\index{S\-P\-I0\-\_\-\-Init@{S\-P\-I0\-\_\-\-Init}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Init}]{\setlength{\rightskip}{0pt plus 5cm}void S\-P\-I0\-\_\-\-Init (
\begin{DoxyParamCaption}
\item[{uint32\-\_\-t}]{speed}
\end{DoxyParamCaption}
)}}\label{spi_8c_a09a39e7befac69f184fd466e10730595}


Initialize S\-P\-I0 device. 


\begin{DoxyItemize}
\item Set default speed, I\-O pins and mode. 
\end{DoxyItemize}

Definition at line 232 of file spi.\-c.



Referenced by main(), and mmc\-\_\-spi\-\_\-init().

\hypertarget{spi_8c_a50834bfd8ff3e59840ef35d5283f5306}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Mode@{S\-P\-I0\-\_\-\-Mode}}
\index{S\-P\-I0\-\_\-\-Mode@{S\-P\-I0\-\_\-\-Mode}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Mode}]{\setlength{\rightskip}{0pt plus 5cm}void S\-P\-I0\-\_\-\-Mode (
\begin{DoxyParamCaption}
\item[{int}]{mode}
\end{DoxyParamCaption}
)}}\label{spi_8c_a50834bfd8ff3e59840ef35d5283f5306}


Set S\-P\-I clock mode. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mode} & valid mades\-: \begin{DoxyVerb}*   SPI Mode     CPOL    CPHA            Sample
*   0    0       0       Leading (Rising)   Edge
*   1    0       1       Trailing (Falling) Edge
*   2    1       0       Leading (Falling)  Edge
*   3    1       1       Trailing (Rising)  Edge
* \end{DoxyVerb}
\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 190 of file spi.\-c.



Referenced by main(), mmc\-\_\-spi\-\_\-init(), and S\-P\-I0\-\_\-\-Init().

\hypertarget{spi_8c_a8e36c17c5822efaecdbcc75829f7582e}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-R\-X@{S\-P\-I0\-\_\-\-R\-X}}
\index{S\-P\-I0\-\_\-\-R\-X@{S\-P\-I0\-\_\-\-R\-X}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-R\-X}]{\setlength{\rightskip}{0pt plus 5cm}void S\-P\-I0\-\_\-\-R\-X (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t $\ast$}]{data, }
\item[{int}]{count}
\end{DoxyParamCaption}
)}}\label{spi_8c_a8e36c17c5822efaecdbcc75829f7582e}


H\-S\-P\-I read using F\-I\-F\-O. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em $\ast$data} & receive buffer \\
\hline
\mbox{\tt in}  & {\em count} & number of bytes to read \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 310 of file spi.\-c.



Referenced by mmc\-\_\-spi\-\_\-\-R\-X(), and mmc\-\_\-spi\-\_\-\-R\-X\-\_\-buffer().

\hypertarget{spi_8c_a4b8379d9d83e3283bb53cfeca92f2e02}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Speed@{S\-P\-I0\-\_\-\-Speed}}
\index{S\-P\-I0\-\_\-\-Speed@{S\-P\-I0\-\_\-\-Speed}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Speed}]{\setlength{\rightskip}{0pt plus 5cm}void S\-P\-I0\-\_\-\-Speed (
\begin{DoxyParamCaption}
\item[{uint32\-\_\-t}]{speed}
\end{DoxyParamCaption}
)}}\label{spi_8c_a4b8379d9d83e3283bb53cfeca92f2e02}


Set A\-V\-R S\-P\-I bus rate in H\-Z. 


\begin{DoxyItemize}
\item Compute precsale rate from desired frequency in H\-Z.
\begin{DoxyItemize}
\item Slowest rate\-: F\-\_\-\-C\-P\-U/128.
\item Fastest rate\-: F\-\_\-\-C\-P\-U/2.
\end{DoxyItemize}
\item Precsale value is truncated not rounded.
\item Valid precsle values are 2,4,8,16,32,64,128. \begin{DoxyVerb}/// SPI2X   SPR1    SPR0     SCK Frequency
/// 1       0       0        fosc/2
/// 0       0       0        fosc/4
/// 1       0       1        fosc/8
/// 0       0       1        fosc/16
/// 1       1       0        fosc/32
/// 0       1       0        fosc/64
/// 1       1       1        fosc/64
/// 0       1       1        fosc/128
/// \end{DoxyVerb}
 \begin{DoxyVerb}@param[in] speed: SPI clock rate in HZ.

@return  void  \end{DoxyVerb}
 
\end{DoxyItemize}Save speed value 

Definition at line 91 of file spi.\-c.



Referenced by S\-P\-I0\-\_\-\-Init().

\hypertarget{spi_8c_a491de3187a3fd4b12dfc1f7fbd50238f}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-T\-X@{S\-P\-I0\-\_\-\-T\-X}}
\index{S\-P\-I0\-\_\-\-T\-X@{S\-P\-I0\-\_\-\-T\-X}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-T\-X}]{\setlength{\rightskip}{0pt plus 5cm}void S\-P\-I0\-\_\-\-T\-X (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t $\ast$}]{data, }
\item[{int}]{count}
\end{DoxyParamCaption}
)}}\label{spi_8c_a491de3187a3fd4b12dfc1f7fbd50238f}


S\-P\-I buffered write functions. 

=================================================================H\-S\-P\-I write using F\-I\-F\-O 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em $\ast$data} & transmit buffer \\
\hline
\mbox{\tt in}  & {\em count} & number of bytes to write \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 279 of file spi.\-c.



Referenced by mmc\-\_\-spi\-\_\-\-T\-X(), and mmc\-\_\-spi\-\_\-\-T\-X\-\_\-buffer().

\hypertarget{spi_8c_a7b56f3fcfe9a88adaac0c59465c0e845}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-T\-X\-R\-X@{S\-P\-I0\-\_\-\-T\-X\-R\-X}}
\index{S\-P\-I0\-\_\-\-T\-X\-R\-X@{S\-P\-I0\-\_\-\-T\-X\-R\-X}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-T\-X\-R\-X}]{\setlength{\rightskip}{0pt plus 5cm}void S\-P\-I0\-\_\-\-T\-X\-R\-X (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t $\ast$}]{data, }
\item[{int}]{count}
\end{DoxyParamCaption}
)}}\label{spi_8c_a7b56f3fcfe9a88adaac0c59465c0e845}


H\-S\-P\-I write and read using F\-I\-F\-O. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em $\ast$data} & transmit / receive buffer \\
\hline
\mbox{\tt in}  & {\em count} & number of bytes to write / read \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 295 of file spi.\-c.



Referenced by mmc\-\_\-spi\-\_\-\-T\-X\-R\-X().

\hypertarget{spi_8c_a795b3fa18e16d366d9a64e88f1cb18ab}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-T\-X\-R\-X\-\_\-\-Byte@{S\-P\-I0\-\_\-\-T\-X\-R\-X\-\_\-\-Byte}}
\index{S\-P\-I0\-\_\-\-T\-X\-R\-X\-\_\-\-Byte@{S\-P\-I0\-\_\-\-T\-X\-R\-X\-\_\-\-Byte}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-T\-X\-R\-X\-\_\-\-Byte}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t S\-P\-I0\-\_\-\-T\-X\-R\-X\-\_\-\-Byte (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{Data}
\end{DoxyParamCaption}
)}}\label{spi_8c_a795b3fa18e16d366d9a64e88f1cb18ab}


S\-P\-I read/\-Write byte. 


\begin{DoxyItemize}
\item We Write and read at the same time.
\item If we want to read only set Data to 0xff.
\end{DoxyItemize}


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em Data} & Data to send.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Data received. 
\end{DoxyReturn}


Definition at line 260 of file spi.\-c.



Referenced by ppr\-\_\-set(), S\-P\-I0\-\_\-\-Init(), S\-P\-I0\-\_\-\-R\-X(), S\-P\-I0\-\_\-\-T\-X(), and S\-P\-I0\-\_\-\-T\-X\-R\-X().



\subsection{Variable Documentation}
\hypertarget{spi_8c_a7c077b6fe081793cd1e55509f7284334}{\index{spi.\-c@{spi.\-c}!\-\_\-\-S\-P\-I0\-\_\-init\-\_\-done@{\-\_\-\-S\-P\-I0\-\_\-init\-\_\-done}}
\index{\-\_\-\-S\-P\-I0\-\_\-init\-\_\-done@{\-\_\-\-S\-P\-I0\-\_\-init\-\_\-done}!spi.c@{spi.\-c}}
\subsubsection[{\-\_\-\-S\-P\-I0\-\_\-init\-\_\-done}]{\setlength{\rightskip}{0pt plus 5cm}int \-\_\-\-S\-P\-I0\-\_\-init\-\_\-done = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{spi_8c_a7c077b6fe081793cd1e55509f7284334}


Definition at line 63 of file spi.\-c.

\hypertarget{spi_8c_a4d167d8fd3bcfa0504b201183b94449b}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Init\-\_\-state@{S\-P\-I0\-\_\-\-Init\-\_\-state}}
\index{S\-P\-I0\-\_\-\-Init\-\_\-state@{S\-P\-I0\-\_\-\-Init\-\_\-state}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Init\-\_\-state}]{\setlength{\rightskip}{0pt plus 5cm}int S\-P\-I0\-\_\-\-Init\-\_\-state = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{spi_8c_a4d167d8fd3bcfa0504b201183b94449b}


S\-P\-I0 initialization flag. 



Definition at line 227 of file spi.\-c.

\hypertarget{spi_8c_ae41154cf3f834c2d151bfa9e67cfc402}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Mode\-\_\-value@{S\-P\-I0\-\_\-\-Mode\-\_\-value}}
\index{S\-P\-I0\-\_\-\-Mode\-\_\-value@{S\-P\-I0\-\_\-\-Mode\-\_\-value}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Mode\-\_\-value}]{\setlength{\rightskip}{0pt plus 5cm}int S\-P\-I0\-\_\-\-Mode\-\_\-value = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{spi_8c_ae41154cf3f834c2d151bfa9e67cfc402}


Saved S\-P\-I Mode. 

\begin{DoxySeeAlso}{See Also}
\hyperlink{spi_8c_a50834bfd8ff3e59840ef35d5283f5306}{S\-P\-I0\-\_\-\-Mode()}. 
\end{DoxySeeAlso}


Definition at line 176 of file spi.\-c.

\hypertarget{spi_8c_a27ad9c881de03a6b8defda1bde93566f}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Speed\-\_\-value@{S\-P\-I0\-\_\-\-Speed\-\_\-value}}
\index{S\-P\-I0\-\_\-\-Speed\-\_\-value@{S\-P\-I0\-\_\-\-Speed\-\_\-value}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Speed\-\_\-value}]{\setlength{\rightskip}{0pt plus 5cm}uint32\-\_\-t S\-P\-I0\-\_\-\-Speed\-\_\-value = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{spi_8c_a27ad9c881de03a6b8defda1bde93566f}


Saved S\-P\-I bus speed. 



Definition at line 67 of file spi.\-c.

