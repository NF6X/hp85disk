\hypertarget{spi_8c}{\section{hardware/spi.c File Reference}
\label{spi_8c}\index{hardware/spi.\-c@{hardware/spi.\-c}}
}


S\-P\-I Driver A\-V\-R8.  


{\ttfamily \#include \char`\"{}hardware.\-h\char`\"{}}\\*
{\ttfamily \#include $<$stdlib.\-h$>$}\\*
{\ttfamily \#include \char`\"{}spi.\-h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{spi_8c_a4b8379d9d83e3283bb53cfeca92f2e02}{S\-P\-I0\-\_\-\-Speed} (uint32\-\_\-t speed)
\begin{DoxyCompactList}\small\item\em Set A\-V\-R S\-P\-I bus rate in H\-Z. \end{DoxyCompactList}\item 
uint32\-\_\-t \hyperlink{spi_8c_a6b19a886a9e63fbc9ed02a6a6361e68b}{S\-P\-I0\-\_\-\-Get\-\_\-\-Speed} (void)
\begin{DoxyCompactList}\small\item\em Return previously saved S\-P\-I B\-U\-S rate in H\-Z. \end{DoxyCompactList}\item 
void \hyperlink{spi_8c_a50834bfd8ff3e59840ef35d5283f5306}{S\-P\-I0\-\_\-\-Mode} (int mode)
\begin{DoxyCompactList}\small\item\em Set S\-P\-I clock mode. \end{DoxyCompactList}\item 
int \hyperlink{spi_8c_ab93aed2163d123a27c97758c8cde0587}{S\-P\-I0\-\_\-\-Get\-\_\-\-Mode} (void)
\begin{DoxyCompactList}\small\item\em Return saved S\-P\-I mode as set by \hyperlink{spi_8c_a50834bfd8ff3e59840ef35d5283f5306}{S\-P\-I0\-\_\-\-Mode()}. \end{DoxyCompactList}\item 
void \hyperlink{spi_8c_ac385baed8fedb7abe92c2219174cc2a2}{S\-P\-I0\-\_\-\-Init} (void)
\begin{DoxyCompactList}\small\item\em Initialize S\-P\-I0 device. \end{DoxyCompactList}\item 
uint8\-\_\-t \hyperlink{spi_8c_af5b6abbef4a0bd9836527999dce8b857}{S\-P\-I0\-\_\-\-Write\-Read\-Byte} (uint8\-\_\-t Data)
\begin{DoxyCompactList}\small\item\em S\-P\-I read/\-Write byte. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static uint32\-\_\-t \hyperlink{spi_8c_a27ad9c881de03a6b8defda1bde93566f}{S\-P\-I0\-\_\-\-Speed\-\_\-value} = 0
\begin{DoxyCompactList}\small\item\em Saved S\-P\-I bus speed. \end{DoxyCompactList}\item 
static int \hyperlink{spi_8c_ae41154cf3f834c2d151bfa9e67cfc402}{S\-P\-I0\-\_\-\-Mode\-\_\-value} = 0
\begin{DoxyCompactList}\small\item\em Saved S\-P\-I Mode. \end{DoxyCompactList}\item 
static int \hyperlink{spi_8c_a4d167d8fd3bcfa0504b201183b94449b}{S\-P\-I0\-\_\-\-Init\-\_\-state} = 0
\begin{DoxyCompactList}\small\item\em S\-P\-I0 initialization flag. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
S\-P\-I Driver A\-V\-R8. \begin{DoxyParagraph}{Edit History}

\begin{DoxyItemize}
\item \mbox{[}1.\-0\mbox{]} \mbox{[}Mike Gore\mbox{]} Initial revision of file.
\end{DoxyItemize}
\end{DoxyParagraph}
\begin{DoxyCopyright}{Copyright}
Copyright \copyright{} 2014 Mike Gore, Inc. All rights reserved.

G\-N\-U Public License.
\end{DoxyCopyright}
\begin{DoxyAuthor}{Author}
Mike Gore 
\end{DoxyAuthor}


Definition in file \hyperlink{spi_8c_source}{spi.\-c}.



\subsection{Function Documentation}
\hypertarget{spi_8c_ab93aed2163d123a27c97758c8cde0587}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Get\-\_\-\-Mode@{S\-P\-I0\-\_\-\-Get\-\_\-\-Mode}}
\index{S\-P\-I0\-\_\-\-Get\-\_\-\-Mode@{S\-P\-I0\-\_\-\-Get\-\_\-\-Mode}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Get\-\_\-\-Mode}]{\setlength{\rightskip}{0pt plus 5cm}int S\-P\-I0\-\_\-\-Get\-\_\-\-Mode (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{spi_8c_ab93aed2163d123a27c97758c8cde0587}


Return saved S\-P\-I mode as set by \hyperlink{spi_8c_a50834bfd8ff3e59840ef35d5283f5306}{S\-P\-I0\-\_\-\-Mode()}. 

\begin{DoxyReturn}{Returns}
saved mode. 
\end{DoxyReturn}


Definition at line 169 of file spi.\-c.

\hypertarget{spi_8c_a6b19a886a9e63fbc9ed02a6a6361e68b}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Get\-\_\-\-Speed@{S\-P\-I0\-\_\-\-Get\-\_\-\-Speed}}
\index{S\-P\-I0\-\_\-\-Get\-\_\-\-Speed@{S\-P\-I0\-\_\-\-Get\-\_\-\-Speed}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Get\-\_\-\-Speed}]{\setlength{\rightskip}{0pt plus 5cm}uint32\-\_\-t S\-P\-I0\-\_\-\-Get\-\_\-\-Speed (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{spi_8c_a6b19a886a9e63fbc9ed02a6a6361e68b}


Return previously saved S\-P\-I B\-U\-S rate in H\-Z. 

\begin{DoxyReturn}{Returns}
S\-P\-I clock rate in H\-Z. 
\end{DoxyReturn}


Definition at line 117 of file spi.\-c.

\hypertarget{spi_8c_ac385baed8fedb7abe92c2219174cc2a2}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Init@{S\-P\-I0\-\_\-\-Init}}
\index{S\-P\-I0\-\_\-\-Init@{S\-P\-I0\-\_\-\-Init}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Init}]{\setlength{\rightskip}{0pt plus 5cm}void S\-P\-I0\-\_\-\-Init (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{spi_8c_ac385baed8fedb7abe92c2219174cc2a2}


Initialize S\-P\-I0 device. 


\begin{DoxyItemize}
\item Set default speed, I\-O pins and mode. 
\end{DoxyItemize}

Definition at line 181 of file spi.\-c.



Referenced by main(), and mmc\-\_\-spi\-\_\-init().

\hypertarget{spi_8c_a50834bfd8ff3e59840ef35d5283f5306}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Mode@{S\-P\-I0\-\_\-\-Mode}}
\index{S\-P\-I0\-\_\-\-Mode@{S\-P\-I0\-\_\-\-Mode}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Mode}]{\setlength{\rightskip}{0pt plus 5cm}void S\-P\-I0\-\_\-\-Mode (
\begin{DoxyParamCaption}
\item[{int}]{mode}
\end{DoxyParamCaption}
)}}\label{spi_8c_a50834bfd8ff3e59840ef35d5283f5306}


Set S\-P\-I clock mode. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mode} & valid mades\-: \begin{DoxyVerb}*   SPI Mode     CPOL    CPHA            Sample
*   0    0       0       Leading (Rising)   Edge
*   1    0       1       Trailing (Falling) Edge
*   2    1       0       Leading (Falling)  Edge
*   3    1       1       Trailing (Rising)  Edge
* \end{DoxyVerb}
\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 139 of file spi.\-c.



Referenced by main(), mmc\-\_\-spi\-\_\-init(), and S\-P\-I0\-\_\-\-Init().

\hypertarget{spi_8c_a4b8379d9d83e3283bb53cfeca92f2e02}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Speed@{S\-P\-I0\-\_\-\-Speed}}
\index{S\-P\-I0\-\_\-\-Speed@{S\-P\-I0\-\_\-\-Speed}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Speed}]{\setlength{\rightskip}{0pt plus 5cm}void S\-P\-I0\-\_\-\-Speed (
\begin{DoxyParamCaption}
\item[{uint32\-\_\-t}]{speed}
\end{DoxyParamCaption}
)}}\label{spi_8c_a4b8379d9d83e3283bb53cfeca92f2e02}


Set A\-V\-R S\-P\-I bus rate in H\-Z. 


\begin{DoxyItemize}
\item Compute precsale rate from desired frequency in H\-Z.
\begin{DoxyItemize}
\item Slowest rate\-: F\-\_\-\-C\-P\-U/128.
\item Fastest rate\-: F\-\_\-\-C\-P\-U/2.
\end{DoxyItemize}
\item Precsale value is truncated not rounded.
\item Valid precsle values are 2,4,8,16,32,64,128. \begin{DoxyVerb}/// SPI2X   SPR1    SPR0     SCK Frequency
/// 1       0       0        fosc/2
/// 0       0       0        fosc/4
/// 1       0       1        fosc/8
/// 0       0       1        fosc/16
/// 1       1       0        fosc/32
/// 0       1       0        fosc/64
/// 1       1       1        fosc/64
/// 0       1       1        fosc/128
/// \end{DoxyVerb}
 \begin{DoxyVerb}@param[in] speed: SPI clock rate in HZ.

@return  void  \end{DoxyVerb}
 
\end{DoxyItemize}Save speed value 

Definition at line 46 of file spi.\-c.



Referenced by main(), mmc\-\_\-fast(), mmc\-\_\-slow(), and S\-P\-I0\-\_\-\-Init().

\hypertarget{spi_8c_af5b6abbef4a0bd9836527999dce8b857}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Write\-Read\-Byte@{S\-P\-I0\-\_\-\-Write\-Read\-Byte}}
\index{S\-P\-I0\-\_\-\-Write\-Read\-Byte@{S\-P\-I0\-\_\-\-Write\-Read\-Byte}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Write\-Read\-Byte}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t S\-P\-I0\-\_\-\-Write\-Read\-Byte (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{Data}
\end{DoxyParamCaption}
)}}\label{spi_8c_af5b6abbef4a0bd9836527999dce8b857}


S\-P\-I read/\-Write byte. 


\begin{DoxyItemize}
\item We Write and read at the same time.
\item If we want to read only set Data to 0xff.
\end{DoxyItemize}


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em Data} & Data to send.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Data received. 
\end{DoxyReturn}


Definition at line 209 of file spi.\-c.



Referenced by mmc\-\_\-xchg\-\_\-spi(), ppr\-\_\-set(), and S\-P\-I0\-\_\-\-Init().



\subsection{Variable Documentation}
\hypertarget{spi_8c_a4d167d8fd3bcfa0504b201183b94449b}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Init\-\_\-state@{S\-P\-I0\-\_\-\-Init\-\_\-state}}
\index{S\-P\-I0\-\_\-\-Init\-\_\-state@{S\-P\-I0\-\_\-\-Init\-\_\-state}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Init\-\_\-state}]{\setlength{\rightskip}{0pt plus 5cm}int S\-P\-I0\-\_\-\-Init\-\_\-state = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{spi_8c_a4d167d8fd3bcfa0504b201183b94449b}


S\-P\-I0 initialization flag. 



Definition at line 176 of file spi.\-c.



Referenced by S\-P\-I0\-\_\-\-Init().

\hypertarget{spi_8c_ae41154cf3f834c2d151bfa9e67cfc402}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Mode\-\_\-value@{S\-P\-I0\-\_\-\-Mode\-\_\-value}}
\index{S\-P\-I0\-\_\-\-Mode\-\_\-value@{S\-P\-I0\-\_\-\-Mode\-\_\-value}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Mode\-\_\-value}]{\setlength{\rightskip}{0pt plus 5cm}int S\-P\-I0\-\_\-\-Mode\-\_\-value = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{spi_8c_ae41154cf3f834c2d151bfa9e67cfc402}


Saved S\-P\-I Mode. 

\begin{DoxySeeAlso}{See Also}
\hyperlink{spi_8c_a50834bfd8ff3e59840ef35d5283f5306}{S\-P\-I0\-\_\-\-Mode()}. 
\end{DoxySeeAlso}


Definition at line 125 of file spi.\-c.



Referenced by S\-P\-I0\-\_\-\-Get\-\_\-\-Mode(), and S\-P\-I0\-\_\-\-Mode().

\hypertarget{spi_8c_a27ad9c881de03a6b8defda1bde93566f}{\index{spi.\-c@{spi.\-c}!S\-P\-I0\-\_\-\-Speed\-\_\-value@{S\-P\-I0\-\_\-\-Speed\-\_\-value}}
\index{S\-P\-I0\-\_\-\-Speed\-\_\-value@{S\-P\-I0\-\_\-\-Speed\-\_\-value}!spi.c@{spi.\-c}}
\subsubsection[{S\-P\-I0\-\_\-\-Speed\-\_\-value}]{\setlength{\rightskip}{0pt plus 5cm}uint32\-\_\-t S\-P\-I0\-\_\-\-Speed\-\_\-value = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{spi_8c_a27ad9c881de03a6b8defda1bde93566f}


Saved S\-P\-I bus speed. 



Definition at line 22 of file spi.\-c.



Referenced by S\-P\-I0\-\_\-\-Get\-\_\-\-Speed(), and S\-P\-I0\-\_\-\-Speed().

