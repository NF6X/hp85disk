<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>HP85 GPIB Disk Emulator: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HP85 GPIB Disk Emulator
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">HP85GPIBDiskEmulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="README"></a>
README</h1>
<dl class="section user"><dt>HP85 Disk Emulator Copyright &copy; 2014 Mike Gore</dt><dd>See <a class="el" href="md_COPYRIGHT.html">COPYRIGHT.md</a> for a full copywrite notice for the project</dd></dl>
<p>This project emulates three GPIB devices</p>
<ul>
<li>SS80 HP9134L disk at 700 for my HP85A (with 85A roms)</li>
<li>Amigo 9121D disk at 710 for my HP85B (with 85B roms)</li>
<li>Printer capture at 720 for my HP54645D scope</li>
</ul>
<hr/>
<h1>Credits</h1>
<p><b>I really owe the very existence of this project to the original work done by Anders Gustafsson and his great "HP Disk Emulator" </b></p>
<ul>
<li>You can visit his project at this site:<ul>
<li><a href="http://www.dalton.ax/hpdisk">http://www.dalton.ax/hpdisk</a></li>
<li><a href="http://www.elektor-labs.com/project/hpdisk-an-sd-based-disk-emulator-for-gpib-instruments-and-computers.13693.html">http://www.elektor-labs.com/project/hpdisk-an-sd-based-disk-emulator-for-gpib-instruments-and-computers.13693.html</a></li>
</ul>
</li>
</ul>
<p><b>Anders Gustafsson was extremely helpful in providing me his current code and details of his project - which I am very thankful for.</b></p>
<p>As mainly a personal excercise in fully understanding the code I ended up rewriting much of the hpdisk project. I did this one part at a time as I learned the protocols and specifications - NOT because of any problems with his original work.</p>
<p>I have retained Anders HP HP9121D and HP9134L data structures found in gpib/defines without modification. Although mostly rewritten I have maintained the concept of state machines for GPIB read and write functions as well as for SS80 execute state tracking.</p>
<hr/>
 <h1>Abbreviations</h1>
<p>Within this project I have attempted to provide detailed referces to to manuals, listed below. I have included short quotes and section and page# reference to these works.</p>
<ul>
<li><b>SS80</b></li>
<li><b>CS80</b></li>
<li><b>A or Amigo</b></li>
<li><b>HP-IP</b></li>
<li><b>HP-IP Tutorial</b></li>
</ul>
<h2>Documentation References and related sources of information</h2>
<ul>
<li>Web Resources<ul>
<li><a href="http://www.hp9845.net">http://www.hp9845.net</a></li>
<li><a href="http://www.hpmuseum.net">http://www.hpmuseum.net</a></li>
<li><a href="http://www.hpmusuem.org">http://www.hpmusuem.org</a></li>
<li><a href="http://bitsavers.trailing-edge.com">http://bitsavers.trailing-edge.com</a></li>
<li><a href="http://en.wikipedia.org/wiki/IEEE-488">http://en.wikipedia.org/wiki/IEEE-488</a></li>
</ul>
</li>
</ul>
<h2>SS80 References: ("SS80" is the short form used in the project)</h2>
<ul>
<li>"Subset 80 from Fixed and flexible disc drives"</li>
<li>Printed November, 1985</li>
<li>HP Part# 5958-4129</li>
</ul>
<h2>CS80 References: ("CS80" is the short form used in the project)</h2>
<ul>
<li>"CS/80 Instruction Set Programming Manual"</li>
<li>Printed: APR 1983</li>
<li>HP Part# 5955-3442</li>
</ul>
<h2>Amigo References: ("A" or "Amigo" is the short form used in the project)</h2>
<ul>
<li>"Appendix A of 9895A Flexible Disc Memory Service Manual"</li>
<li>HP Part# 09895-90030</li>
</ul>
<h2>HP-IB</h2>
<ul>
<li>("HP-IB" is the short form used in the project)</li>
<li>"Condensed Description of the Hewlett Packard Interface Bus"</li>
<li>Printed March 1975</li>
<li>HP Part# 59401-90030</li>
</ul>
<h2>Tutorial Description of The Hewllet Packard Interface Bus</h2>
<ul>
<li>("HP-IB Tutorial" is the short form used in the project)</li>
<li><a href="http://www.hpmemory.org/an/pdf/hp-ib_tutorial_1980.pdf">http://www.hpmemory.org/an/pdf/hp-ib_tutorial_1980.pdf</a></li>
<li>Printed January 1983</li>
<li><a href="http://www.ko4bb.com/Manuals/HP_Agilent/HPIB_tutorial_HP.pdf">http://www.ko4bb.com/Manuals/HP_Agilent/HPIB_tutorial_HP.pdf</a></li>
<li>Printed 1987</li>
</ul>
<h2>GPIB / IEEE 488 Tutorial by Ian Poole</h2>
<ul>
<li><a href="http://www.radio-electronics.com/info/t_and_m/gpib/ieee488-basics-tutorial.php">http://www.radio-electronics.com/info/t_and_m/gpib/ieee488-basics-tutorial.php</a></li>
</ul>
<h2>HP 9133/9134 D/H/L References</h2>
<ul>
<li>"HP 9133/9134 D/H/L Service Manual"</li>
<li>HP Part# 5957-6560</li>
<li>Printed: APRIL 1985, Edition 2</li>
</ul>
<h2>LIF Filesystem Format</h2>
<ul>
<li><a href="http://www.hp9845.net/9845/projects/hpdir/#lif_filesystem">http://www.hp9845.net/9845/projects/hpdir/#lif_filesystem</a></li>
</ul>
<h2>Useful Utilities</h2>
<ul>
<li>HP Drive (HP Drive Emulators for Windows Platform)<ul>
<li><a href="http://www.hp9845.net/9845/projects/hpdrive/">http://www.hp9845.net/9845/projects/hpdrive/</a></li>
</ul>
</li>
<li>HP Dir (HP Drive - Disk Image Manipulation)<ul>
<li><a href="http://www.hp9845.net/9845/projects/hpdir/">http://www.hp9845.net/9845/projects/hpdir/</a></li>
</ul>
</li>
</ul>
<hr/>
<h2>GPIB Connector pinout by Anders Gustafsson in his hpdisk project</h2>
<ul>
<li><a href="http://www.dalton.ax/hpdisk/">http://www.dalton.ax/hpdisk/</a></li>
</ul>
<pre class="fragment">Pin Name    Signal Description       Pin    Name    Signal Description 
1   DIO1    Data Input/Output Bit 1  13     DIO5    Data Input/Output Bit 5 
2   DIO2    Data Input/Output Bit 2  14     DIO6    Data Input/Output Bit 6 
3   DIO3    Data Input/Output Bit 3  15     DIO7    Data Input/Output Bit 7 
4   DIO4    Data Input/Output Bit 4  16     DIO8    Data Input/Output Bit 8 
5   EIO     End-Or-Identify          17     REN     Remote Enable 
6   DAV     Data Valid               18     Shield  Ground (DAV) 
7   NRFD    Not Ready For Data       19     Shield  Ground (NRFD) 
8   NDAC    Not Data Accepted        20     Shield  Ground (NDAC) 
9   IFC     Interface Clear          21     Shield  Ground (IFC) 
10  SRQ     Service Request          22     Shield  Ground (SRQ) 
11  ATN     Attention                23     Shield  Ground (ATN) 
12  Shield  Chassis Ground           24     Single GND Single Ground
</pre> <hr/>
<h2>AVR ATMEGA1284P pin assignments for HP85 Disk</h2>
<ul>
<li>GPIB: Each GPIB pin (8 data and 8 control lines ) attach to CPU with a 120 ohm current limit resistor .<ul>
<li>Each GPIB pin (8 data and 8 control lines ) have a 10K pull-up resistor to VCC.</li>
</ul>
</li>
<li>ISP header: MOSI,MISO,SCK,/Reset connects directly to ISP header</li>
<li>Micro SD Interface: MOSI,MISO,SCK attach to CPU function via a 1k series resistor.<ul>
<li>Micro SD interface has level shifters and internal 5V to 3.3V regulator</li>
</ul>
</li>
<li>RS232 TTL: connect to FTDI232 USB board which also provides 5V VCC power to all circuits..</li>
<li>I2C: SCL,SDA connect to optional DS1307 RTC board with each line having a 2k2 pull-up</li>
</ul>
<pre class="fragment">                   ATMEGA1284P (and ATMEGA644P) 
                   +---\/---+ 
 5 EOI INT0  PB0  1|        |40  PA0      D1  1 
 6 DAV INT1  PB1  2|        |39  PA1      D2  2 
   PP  INT2  PB2  3|        |38  PA2      D3  3 
SD /CS  PWM  PB3  4|        |37  PA3      D4  4 
   NC   PWM  PB4  5|        |36  PA4      D5 13 
SD     MOSI  PB5  6|        |35  PA5      D6 14 
SD     MISO  PB6  7|        |34  PA6      D7 15 
SD      SCK  PB7  8|        |33  PA7      D8 16 
10K pullup  /RST  9|        |32  AREF     0.1uf 
   +5        VCC 10|        |31  GND      GND   
   GND       GND 11|        |30  AVCC     +5    
20MHZ      XTAL2 12|        |29  PC7      NC    
20MHZ      XTAL1 13|        |28  PC6      NC    
   RX   RX0  PD0 14|        |27  PC5  TDI JTAG 
   TX   TX0  PD1 15|        |26  PC4  TDO JTAG 
 7 NRFD RX1  PD2 16|        |25  PC3  TMS JTAG 
 8 NDAC TX1  PD3 17|        |24  PC2  TCK JTAG 
 9 IFC  PWM  PD4 18|        |23  PC1  SDA I2C   
10 SRQ  PWM  PD5 19|        |22  PC0  SCL I2C  
11 ATN  PWM  PD6 20|        |21  PD7  PWM REN 17 
                   +--------+ 
</pre><hr/>
<h2>Parallel Poll Response circuit</h2>
<ul>
<li>Uses: Three chips 74HC05, 74HC32, 74HC595</li>
<li>Parallel Poll Response must be less then 2 Microseconds therefore we use hardware to do it!</li>
</ul>
<pre class="fragment"> ATMEGA            HC595            HC05 
                   +---\/---+          +-\/-+  
 3 PB3 -------- 12 |RCLK  Q0| 15 -x- 1 |    | 2 --- GPIB D8 
 6 MOSI ------- 14 |SER   Q1| 1  -x- 3 |    | 4 --- GPIB D7 
 8 SCK -------- 11 |SRCLK Q2| 2  -x- 5 |    | 6 --- GPIB D6 
 9 IFC -------- 10 |SRCLR Q3| 3  -x- 9 |    | 8 --- GPIB D5 
       HC32        |        |     |    |    | 7 GND 
       +-\/-+      |        |     |    |    |14 VCC 
  EOI 2|    |      |        |     |    +----+ 
  ATN 1|    |      |        |     \--- each line has its own 
       |    | 1-13 |/OE     |          10K resistor to GND 
 VCC 14|    |      |        | 16 VCC 
 GND  7|    |      |        |  8 GND 
       +----+      +--------+ 
</pre><p>Notes: When both EOI and ATN are low the HC32 enables HC595 outputs</p>
<ul>
<li>If any HC595 output is high the GPIB bus bit will be pulled low</li>
<li>IFC low resets the outputs low </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Feb 9 2015 19:24:56 for HP85 GPIB Disk Emulator by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
